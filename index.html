<!DOCTYPE html>
  <html lang="es">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Control de inversiones - Iniciar sesión</title>
      <script src="https://apis.google.com/js/platform.js"></script>
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
      <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
      <script src="https://script.google.com/macros/library/gg"></script>
      <link
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        rel="stylesheet"
      />
      <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
      />
      
      <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"  rel="stylesheet"     />-->
      <?!= obtenerLibrerias('bootstrap5CSS') ?>
      <?!= obtenerLibrerias('css') ?>
      <script>
        //---------------------- CARGAR DATOS POR DEFECTO ----------------
        $(document).ready(function() {
          function cargarDatos(query, columna, targetElement) {
            google.script.run.withSuccessHandler(function(data) {
              $(targetElement).empty();
              if ($(targetElement).is('select')) {
                  $(targetElement).append('<option value="" disabled selected>Seleccione...</option>');
                  data.forEach(function(item, index) {
                    $(targetElement).append(
                      $('<option>', {
                        value: index + 1, 
                        text: item
                      })
                    );
                  });
                }
                else if ($(targetElement).is('div') && targetElement.id === 'radioButtons') {
                  data.forEach(function(item) {
                    $(targetElement).append(
                      $('<label>', {
                        text: item
                      }).prepend(
                        $('<input>', {
                          type: 'radio',
                          name: 'opcion',
                          value: item
                        })
                      )
                    );
                  });
                }
                else if ($(targetElement).is('span') || $(targetElement).is('div')) {
                  $(targetElement).text(data.join(", "));
                }
                else if ($(targetElement).is('h1') || $(targetElement).is('h2') || $(targetElement).is('h3')) {
                  $(targetElement).text(data.join(" | "));
                }
                else if ($(targetElement).is('p')) {
                  $(targetElement).text(data.join(" - "));
                }
            }).test(query, columna);
          }

          let idInfo = 1;
          cargarDatos("select * from AG_Roles", "nombre_rol", "#rol");
          cargarDatos("select * from AG_ConcesionesMineras", "nombre_lote", "#nombreLoteCompartida");
          cargarDatos("select * from AG_Conceptos_Ley", "descripcion", "#conceptoLeyInv");
          cargarDatos("select * from AG_Conceptos_Ley", "descripcion", "#conceptoLeyProd");
          cargarDatos("select * from AG_Conceptos_Ley", "descripcion", "#conceptoLeySus");
          function actualizarInfoModal() {
            cargarDatos("select * from AG_InfoModalInicio where id_info=" + idInfo, "descripcion_info", "#descripcionInfo");
            idInfo++;
            if (idInfo > 4) {
              idInfo = 1;
            }
          }
          actualizarInfoModal();
          setInterval(actualizarInfoModal, 10000);
        });     
//------------------- USUARIOS -------------------------
        $(document).ready(function() {
          var idUsuarioSeleccionado = null;

          function mostrarSpinner() {
            $('#loadingSpinner').show();
          }
          function ocultarSpinner() {
            $('#loadingSpinner').hide();
          }
          // Cargar la tabla de usuarios
          function cargarTablaUsuarios(query, targetElement) {
            google.script.run.withSuccessHandler(function(data) {
              $(targetElement).empty(); // Limpiar la tabla actual

              if (data.length > 0) {
                var tabla = $('<table>', { class: 'table table-bordered table-responsive' });
                var thead = $('<thead>');
                var tbody = $('<tbody>');    
                var encabezados = [
                  { campo: 'nombre_usuario', texto: 'Nombre(s)' },
                  { campo: 'apellidop', texto: 'Apellido Paterno' },
                  { campo: 'apellidom', texto: 'Apellido Materno' },
                  { campo: 'correo', texto: 'Correo' },
                  { campo: 'puesto', texto: 'Puesto' },
                  { campo: 'area_trabajo', texto: 'Departamento' },
                  { campo: 'id_rol', texto: 'Rol' }
                ];

                // crear encabezados
                var trEncabezados = $('<tr>');
                trEncabezados.append($('<th>').text('No.'));
                encabezados.forEach(function(encabezado) {
                  trEncabezados.append($('<th>').text(encabezado.texto));
                });
                thead.append(trEncabezados);

                // Crear filas de datos
                data.forEach(function(fila, index1) {
                  var trFila = $('<tr>').attr('data-id', fila.id_usuario);
                  trFila.append($('<td>').text(index1 + 1));

                  // Asignar valores de las filas a cada columna
                  encabezados.forEach(function(encabezado) {
                    var valor = fila[encabezado.campo];
                    if (encabezado.campo === 'id_rol') {
                      switch (valor) {
                        case 1:
                          valor = 'Administrador';
                          break;
                        case 2:
                          valor = 'Fundos';
                          break;
                        case 3:
                          valor = 'Geólogos';
                          break;
                        case 4:
                          valor = 'Directivos';
                          break;
                        default:
                          valor = 'Desconocido';
                      }
                    }
                    trFila.append($('<td>').text(valor));
                  });
                  trFila.click(function() {
                    $('tr').removeClass('seleccionada');
                    $(this).addClass('seleccionada');
                    var id_usuario = $(this).data('id');
                    idUsuarioSeleccionado = id_usuario; 
                    // Cargar los datos en el formulario
                    $('#nombre').val(fila.nombre_usuario);
                    $('#apellidoPaterno').val(fila.apellidop);
                    $('#apellidoMaterno').val(fila.apellidom);
                    $('#correo').val(fila.correo);
                    $('#puestoUsuario').val(fila.puesto);
                    $('#departamentoUsuario').val(fila.area_trabajo);
                    var rol = fila.id_rol;
                    $('#rol').val(rol); 
                    $('#usuario').val(fila.usuario);
                    $('#contrasena').val(fila.contrasena);
                  });
                  tbody.append(trFila);
                });
                tabla.append(thead).append(tbody);
                $(targetElement).append(tabla);
              }
              ocultarSpinner(); // Ocultar el spinner una vez que los datos esten cargados
            }).peticion(query);
          }
          // Cargar la tabla inicialmente
          cargarTablaUsuarios("select * from AG_Usuarios", "#tablaUsuarios");
          // Mapeo de roles
          function obtenerValorRol() {
            var rolSeleccionado = $('#rol').val();
            switch (rolSeleccionado) {
              case '1':
                return 1;
              case '2':
                return 2;
              case '3':
                return 3;
              case '4':
                return 4;
              default:
                return null; 
            }
          }
          // funcion para quitar la selección del usuario
          $('#btnQuitarSeleccionUsuario').click(function() {
            $('tr').removeClass('seleccionada');  // Quitar la clase de selección de todas las filas
            idUsuarioSeleccionado = null;  // Limpiar la variable del usuario seleccionado
            // limpiar los campos del formulario
            $('#nombre').val('');
            $('#apellidoPaterno').val('');
            $('#apellidoMaterno').val('');
            $('#correo').val('');
            $('#puestoUsuario').val('');
            $('#departamentoUsuario').val('');
            $('#rol').val('');
            $('#usuario').val('');
            $('#contrasena').val('');
          });
          // Funcion para refrescar la tabla cuando se hace clic en el boton
          $('#btnRefrescarTablaUsuarios').click(function() {
            mostrarSpinner(); 
            cargarTablaUsuarios("select * from AG_Usuarios", "#tablaUsuarios");
          });
          // Agregar nuevo usuario
          $('#btnAgregarUsuario').click(function() {
            var nombre_usuario = $('#nombre').val();
            var apellidoPaterno = $('#apellidoPaterno').val();
            var apellidoMaterno = $('#apellidoMaterno').val();
            var correo = $('#correo').val();
            var puesto = $('#puestoUsuario').val();
            var departamento = $('#departamentoUsuario').val();
            var rol = obtenerValorRol();  // Obtener el valor del rol mapeado
            var usuario = $('#usuario').val();
            var contrasena = $('#contrasena').val();
            // Validar que no haya campos vacíos
            if (nombre_usuario && apellidoPaterno && apellidoMaterno && correo && puesto && departamento && rol && usuario && contrasena) {
              // Verificar si el usuario ya existe
              google.script.run.withSuccessHandler(function(existencia) {
                if (existencia.length > 0) {
                  alert("El usuario ya existe. Por favor elige otro nombre de usuario.");
                } else {
                  google.script.run.insertarUsuario(nombre_usuario, apellidoPaterno, apellidoMaterno, correo, puesto, departamento, rol, usuario, contrasena);
                  mostrarSpinner();
                  // Recargar la tabla después de agregar el usuario
                  cargarTablaUsuarios("select * from AG_Usuarios", "#tablaUsuarios");
                  // Limpiar los campos del formulario después de agregar
                  $('#nombre').val('');
                  $('#apellidoPaterno').val('');
                  $('#apellidoMaterno').val('');
                  $('#correo').val('');
                  $('#puestoUsuario').val('');
                  $('#departamentoUsuario').val('');
                  $('#rol').val('');
                  $('#usuario').val('');
                  $('#contrasena').val('');  
                }
              }).verificarUsuarioExistente(usuario, idUsuarioSeleccionado);
            } else {
                alert('Por favor completa todos los campos.');
            }
          });

          // Editar usuario
          $('#btnEditarUsuario').click(function() {
            if (idUsuarioSeleccionado) {
              var nombre_usuario = $('#nombre').val();
              var apellidoPaterno = $('#apellidoPaterno').val();
              var apellidoMaterno = $('#apellidoMaterno').val();
              var correo = $('#correo').val();
              var puesto = $('#puestoUsuario').val();
              var departamento = $('#departamentoUsuario').val();
              var rol = obtenerValorRol();  // Obtener el valor del rol mapeado
              var usuario = $('#usuario').val();
              var contrasena = $('#contrasena').val();


              if (nombre_usuario && apellidoPaterno && apellidoMaterno && correo && puesto && departamento && rol && usuario && contrasena) {
              // Verificar si el usuario ya existe
              google.script.run.withSuccessHandler(function(existencia) {
                if (existencia.length > 0) {
                  alert("El usuario ya existe. Por favor elige otro nombre de usuario.");
                } else {
                  google.script.run.actualizarUsuario(idUsuarioSeleccionado, nombre_usuario, apellidoPaterno, apellidoMaterno, correo, puesto, departamento, rol, usuario, contrasena);
                  mostrarSpinner();
                  // Recargar la tabla después de agregar el usuario
                  cargarTablaUsuarios("select * from AG_Usuarios", "#tablaUsuarios");
                  // Limpiar los campos del formulario después de agregar
                  $('#nombre').val('');
                  $('#apellidoPaterno').val('');
                  $('#apellidoMaterno').val('');
                  $('#correo').val('');
                  $('#puestoUsuario').val('');
                  $('#departamentoUsuario').val('');
                  $('#rol').val('');
                  $('#usuario').val('');
                  $('#contrasena').val('');  
                }
              }).verificarUsuarioExistente(usuario, idUsuarioSeleccionado);
            } else {
                alert('Por favor completa todos los campos.');
            }
            } else {
              alert('Por favor selecciona un usuario de la tabla.');
            }
          });
          // Botón Eliminar
          $('#btnEliminarUsuario').click(function() {
            if (idUsuarioSeleccionado) {
              if (confirm('¿Estás seguro de eliminar este usuario?')) {
                google.script.run.eliminarUsuario(idUsuarioSeleccionado);
                mostrarSpinner(); // Mostrar el spinner mientras se elimina el usuario
                // Recargar la tabla después de eliminar el registro
                cargarTablaUsuarios("select * from AG_Usuarios", "#tablaUsuarios");
              }
            } else {
              alert('Por favor selecciona un usuario de la tabla.');
            }
          });
  
        });
//--------------------- CARGAR DATOS POR DEFECTO ---------------------------------        
        $(document).ready(function() {
          function cargarTablaCon(query, targetElement) { 
          google.script.run.withSuccessHandler(function(data) {
            $(targetElement).empty();

            if (targetElement === "#tablaCon" && data.length > 0) {
              var tabla = $('<table>', { class: 'table table-bordered table-responsive' }); 
              var thead = $('<thead>');
              var tbody = $('<tbody>');
              var columnas = Object.keys(data[0]);

              // Crear fila de encabezado
              var trEncabezados = $('<tr>');
              columnas.forEach(function(columna) {
                trEncabezados.append($('<th>').text(columna));
              });
              thead.append(trEncabezados);
              data.forEach(function(fila) {
                  var trFila = $('<tr>').attr('data-id', fila.id_usuario); 

                  columnas.forEach(function(columna) {
                    trFila.append($('<td>').text(fila[columna]));
                  });

                  trFila.click(function() {
                    $('tr').removeClass('seleccionada');
                    $(this).addClass('seleccionada');
                    var id_usuario = $(this).data('id');
                    console.log('ID del usuario seleccionado:', id_usuario);
                    $('#nombre').val(fila.nombre_usuario);
                  });
                  tbody.append(trFila);
              });
              tabla.append(thead).append(tbody);
              $(targetElement).append(tabla);
            }
          }).peticion(query); 
          }
          cargarTablaCon("select * from AG_Roles", "#tablaCon");  
        });
        $(document).ready(function() {        
          function cargarInfoRes(query, targetElement) { 
            google.script.run.withSuccessHandler(function(data) {
              $(targetElement).empty();
              // Filtrar los usuarios activos   
              var usuariosActivos = data.filter(function(fila) {
                return fila.activo === 1;  // Filtramos solo usuarios activos
              });
              if (usuariosActivos.length > 0) {
                // Crear el contenedor para los radio buttons
                var radioGroup = $('<div>', { id: 'radiosRes' });
                // Iterar sobre los usuarios activos y crear un radio button por cada uno
                usuariosActivos.forEach(function(fila) {
                  var radioButton = $('<input>', { 
                    type: 'radio', 
                    name: 'usuario', 
                    value: fila.id_usuario, 
                    id: 'radio_' + fila.id_usuario,
                    class: 'btn-check', 
                    autocomplete: 'off'
                  });          
                  // Mostrar nombre, apellido paterno y apellido materno en el radio button
                  var label = $('<label>', { 
                    'for': 'radio_' + fila.id_usuario,
                    class: 'btn btn-outline-primary btn-lg mb-2 animate__animated animate__fadeIn' // Bootstrap + Animate.css class
                  }).text(fila.nombre_usuario + ' ' + fila.apellidop + ' ' + fila.apellidom);  
                  // Agregar el radio button y su label al grupo
                  radioGroup.append(radioButton).append(label).append('<br>');
                });
                // Agregar el grupo de radio buttons al contenedor
                $(targetElement).append(radioGroup);    
                // Manejar la selección del radio button
                $('input[name="usuario"]').change(function() {
                  var idUsuarioSeleccionado = $(this).val();
                  var usuarioSeleccionado = usuariosActivos.find(function(fila) {
                    return fila.id_usuario == idUsuarioSeleccionado;
                  });
                  if (usuarioSeleccionado) {
                    // Verificar que las etiquetas existan y actualizarlas
                    console.log("Usuario seleccionado:", usuarioSeleccionado); 
                    $('#apellidoPaternoRL').text(usuarioSeleccionado.apellidop);
                    $('#apellidoMaternoRL').text(usuarioSeleccionado.apellidom);
                    $('#telefonoR').text(usuarioSeleccionado.Telefono);
                    $('#extensionR').text(usuarioSeleccionado.Extension);
                    $('#correoR').text(usuarioSeleccionado.correo);
                    $('#nombreRL').text(usuarioSeleccionado.nombre_usuario);
                    $('#rfcRL').text(usuarioSeleccionado.RFC);
                    $('#curpRL').text(usuarioSeleccionado.CURP);
                    $('#telefonoRL').text(usuarioSeleccionado.Telefono);    
                    // Animación para los apellidos al ser actualizados
                    $('#apellidoPaternoRL, #apellidoMaternoRL').addClass('animate__animated animate__bounceIn');
                  }
                });
              }
            }).peticion(query); 
          }
          // Llamada para cargar los usuarios activos
          cargarInfoRes("select * from AG_Usuarios", "#radiosRes");
        });

//-------------------------- INPC ------------------------
        $(document).ready(function() {  
          // Función para mostrar el spinner
          function mostrarSpinner() {
            $('#loadingSpinner').show();
          }
          // Función para ocultar el spinner
          function ocultarSpinner() {
            $('#loadingSpinner').hide();
          }
          function cargarTablaINPC(query, targetElement) { 
            google.script.run.withSuccessHandler(function(data) {
              $(targetElement).empty();
              if (targetElement === "#tablaINPC" && data.length > 0) {
                var tabla = $('<table>', { class: 'table table-bordered table-responsive' }); 
                var thead = $('<thead>');
                var tbody = $('<tbody>');
                // Encabezados para la tabla 
                var trEncabezados = $('<tr>');
                trEncabezados.append($('<th>').text('Fecha Registro'));
                trEncabezados.append($('<th>').text('Fecha Año Anterior'));
                trEncabezados.append($('<th>').text('Año a Comprobar'));
                trEncabezados.append($('<th>').text('Valor Inmediato Anterior'));
                trEncabezados.append($('<th>').text('Valor Inmediato Actual'));
                trEncabezados.append($('<th>').text('Factor INPC'));
                thead.append(trEncabezados);
                data.forEach(function(fila) {
                  var trFila = $('<tr>').attr('data-id', fila.id_inpc);
                  // Insertar los valores de la tabla 
                  trFila.append($('<td>').text(fila.fecha)); 
                  trFila.append($('<td>').text(fila.anio_anterior)); 
                  trFila.append($('<td>').text(fila.anio_actual));   
                  trFila.append($('<td>').text(fila.valor_anterior)); 
                  trFila.append($('<td>').text(fila.valor_actual)); 
                  trFila.append($('<td>').text(fila.total_inpc));     
                  trFila.click(function() {
                    $('tr').removeClass('seleccionada');
                    $(this).addClass('seleccionada');
                    var id_inpc = $(this).data('id');
                    console.log('ID INPC seleccionado:', id_inpc);
                    $('#fecha').val(fila.fecha);
                    $('#anioAnterior').val(fila.anio_anterior);
                    $('#anioComprobar').val(fila.anio_actual);
                    $('#valorAnterior').val(fila.valor_anterior);
                    $('#valorActual').val(fila.valor_actual);
                    $('#totalINPC').val(fila.total_inpc);
                  });
                  tbody.append(trFila);
                });
                tabla.append(thead).append(tbody);
                $(targetElement).append(tabla);
              }
              ocultarSpinner();
            }).peticion(query); 
          }
          $('#refrescarTablaINPC').click(function() {
            mostrarSpinner();  
            cargarTablaINPC("select * from AG_INPC", "#tablaINPC");
          });

          cargarTablaINPC("select * from AG_INPC", "#tablaINPC");    
        });

        $(document).ready(function() {
          // Función para mostrar el spinner
          function mostrarSpinner() {
            $('#loadingSpinner').show();  
          }
          // Función para ocultar el spinner
          function ocultarSpinner() {
            $('#loadingSpinner').hide(); 
          }
          // Función para cargar la tabla con el último registro 
          function cargarTablaNuevoINPC(query, targetElement) { 
            mostrarSpinner();  
            google.script.run.withSuccessHandler(function(data) {
              $(targetElement).empty(); 
              if (targetElement === "#tablaNuevoINPC" && data.length > 0) {
                var tabla = $('<table>', { class: 'table table-bordered table-responsive' });
                var thead = $('<thead>');
                var tbody = $('<tbody>');
                var trEncabezados = $('<tr>');
                trEncabezados.append($('<th>').text('Fecha Registro'));
                trEncabezados.append($('<th>').text('Fecha Año Anterior'));
                trEncabezados.append($('<th>').text('Año a Comprobar'));
                trEncabezados.append($('<th>').text('Valor Inmediato Anterior'));
                trEncabezados.append($('<th>').text('Valor Inmediato Actual'));
                trEncabezados.append($('<th>').text('Factor INPC'));
                thead.append(trEncabezados);
                data.forEach(function(fila) {
                  var trFila = $('<tr>').attr('data-id', fila.id_inpc);
                  trFila.append($('<td>').text(fila.fecha));
                  trFila.append($('<td>').text(fila.anio_anterior));
                  trFila.append($('<td>').text(fila.anio_actual));
                  trFila.append($('<td>').text(fila.valor_anterior));
                  trFila.append($('<td>').text(fila.valor_actual));
                  trFila.append($('<td>').text(fila.total_inpc));
                  tbody.append(trFila);
                });
                tabla.append(thead).append(tbody);
                $(targetElement).append(tabla);
              }
              ocultarSpinner(); 
            }).peticion(query); 
          }
          // Función para calcular el INPC y agregar el nuevo registro 
          $('#calcularINPC').click(function() {
            var inpcAnterior = parseFloat($('#inpcAnterior').val().trim());
            var inpcActual = parseFloat($('#inpcActual').val().trim());
            var periodo = $('#periodoINPC').val().trim();
            if (isNaN(inpcAnterior) || isNaN(inpcActual) || !periodo) {
              alert('Por favor, completa todos los campos correctamente.');
              return;
            }
            // Obtener la fecha actual en formato yyyy-mm-dd
            var fechaActual = new Date();
            var fechaFormato = fechaActual.getFullYear() + '-' +
            (fechaActual.getMonth() + 1).toString().padStart(2, '0') + '-' +
            fechaActual.getDate().toString().padStart(2, '0');
            // Obtener el año anterior
            var anioActual = fechaActual.getFullYear();
            var anioAnterior = anioActual - 1;  
            // Calcular el total_inpc 
            var totalINPC = inpcActual / inpcAnterior;
            var consulta = "INSERT INTO AG_INPC (fecha, anio_anterior, anio_actual, valor_anterior, valor_actual, total_inpc, periodo) " +
                   "VALUES ('" + fechaFormato + "', '" + anioAnterior + "', '" + anioActual + "', " + inpcAnterior + ", " + inpcActual + ", " + totalINPC.toFixed(4) + ", '" + periodo + "')";
            google.script.run.withSuccessHandler(function() {
              // Recargar la tabla después de agregar el registro 
              cargarTablaNuevoINPC("SELECT top(1) * FROM AG_INPC ORDER BY fecha DESC;", "#tablaNuevoINPC");
            }).peticion(consulta);  
            mostrarSpinner();
          });
          cargarTablaNuevoINPC("SELECT top(1) * FROM AG_INPC ORDER BY fecha DESC;", "#tablaNuevoINPC");
        });
//----------------- MONTOS MINIMOS -------------------------
        $(document).ready(function() {
          // Función para mostrar el spinner
          function mostrarSpinner() {
            $('#loadingSpinner').show();  
          }
          // Función para ocultar el spinner
          function ocultarSpinner() {
            $('#loadingSpinner').hide(); 
          }
          // Función para cargar la tabla según el periodo seleccionado
          function cargarTablaMontosMinimos(query, targetElement) {
            mostrarSpinner();  
            google.script.run.withSuccessHandler(function(data) {
              $(targetElement).empty();  
              if (targetElement === "#tablaMontosMinimos" && data.length > 0) {
                var tabla = $('<table>', { class: 'table table-bordered table-responsive' });
                var thead = $('<thead>');
                var tbody = $('<tbody>');
                var trEncabezados = $('<tr>');
                trEncabezados.append($('<th>').text('Periodo'));
                trEncabezados.append($('<th>').text('Rango Superficie (ha)'));
                trEncabezados.append($('<th>').text('Cuota Fija (Pesos MXN)'));
                trEncabezados.append($('<th>').text('Cuota Adicional (1er año)'));
                trEncabezados.append($('<th>').text('Cuota Adicional (2° a 4° año)'));
                trEncabezados.append($('<th>').text('Cuota Adicional (5° a 6° año)'));
                trEncabezados.append($('<th>').text('Cuota Adicional (7° año)'));
                thead.append(trEncabezados);
                data.forEach(function(fila) {
                  var trFila = $('<tr>');
                  trFila.append($('<td>').text(fila.ejercicio)); 
                  trFila.append($('<td>').text(fila.rangosuperficieHas)); 
                  trFila.append($('<td>').text(fila.cuotafija)); 
                  trFila.append($('<td>').text(fila.primer_anio_cuotaadicional)); 
                  trFila.append($('<td>').text(fila.segundo_anio_cuotaadicional)); 
                  trFila.append($('<td>').text(fila.quinto_anio_cuotaadicional));
                  trFila.append($('<td>').text(fila.septimo_anio_cuotaadicional)); 
                  tbody.append(trFila);
                });
                tabla.append(thead).append(tbody);
                $(targetElement).append(tabla);
              } else {
                $(targetElement).append('<p>No se encontraron datos para este periodo.</p>');
              }
              ocultarSpinner();  
            }).peticion(query);  
          }
          // Función para manejar el cambio en el selector de periodo
          $('#periodoBusquedaMM').change(function() {
            var periodoSeleccionado = $(this).val().trim();
            if (periodoSeleccionado) {
              var consulta = "SELECT * FROM AG_MontosMinimos WHERE ejercicio = '" + periodoSeleccionado + "'";
              cargarTablaMontosMinimos(consulta, "#tablaMontosMinimos");
            } else {
              $('#tablaMontosMinimos').empty();
              $('#tablaMontosMinimos').append('<p>Por favor, selecciona un periodo.</p>');
            }
          });    
        });

//------------------------- RESPONSABLES --------------------------
        $(document).ready(function() {
          function mostrarSpinner() {
            $('#loadingSpinner').show();
          }
          function ocultarSpinner() {
            $('#loadingSpinner').hide();
          }
          // Función para cargar la tabla inicialmente
          function cargarTablaRes(query, targetElement) {
            mostrarSpinner();  
            google.script.run.withSuccessHandler(function(data) {
              $(targetElement).empty();  
              if (targetElement === "#tablaRes" && data.length > 0) {
                var tabla = $('<table>', { class: 'table table-bordered table-responsive' });
                var thead = $('<thead>');
                var tbody = $('<tbody>');
                var encabezados = [
                  { campo: 'nombre_usuario', texto: 'Nombre(s)' },
                  { campo: 'apellidop', texto: 'Apellido Paterno' },
                  { campo: 'apellidom', texto: 'Apellido Materno' },
                  { campo: 'CURP', texto: 'CURP' },
                  { campo: 'RFC', texto: 'RFC' },
                  { campo: 'correo', texto: 'Correo' },
                  { campo: 'Telefono', texto: 'Telefono' },
                  { campo: 'Extension', texto: 'Extensión' }
                ];
                var trEncabezados = $('<tr>');
                trEncabezados.append($('<th>').text('No.'));
                encabezados.forEach(function(encabezado) {
                  trEncabezados.append($('<th>').text(encabezado.texto));
                });
                thead.append(trEncabezados);
                data.forEach(function(fila, index) {
                  var trFila = $('<tr>').attr('data-id', fila.id_usuario);
                  trFila.append($('<td>').text(index + 1));
                  encabezados.forEach(function(encabezado) {
                    var valor = fila[encabezado.campo];
                    trFila.append($('<td>').text(valor));
                  });
                  trFila.click(function() {
                    seleccionarFila(this, fila);  
                  });
                  tbody.append(trFila);
                });
                tabla.append(thead).append(tbody);
                $(targetElement).append(tabla);
              }
              ocultarSpinner();  
            }).peticion(query); 
          }
          function seleccionarFila(filaElement, filaData) {
            $('tr').removeClass('seleccionada');
            $(filaElement).addClass('seleccionada');  
            $('#nombreRes').val(filaData.nombre_usuario);
            $('#apellidoPRes').val(filaData.apellidop);
            $('#apellidoMRes').val(filaData.apellidom);  
            $('#curpRes').val(filaData.CURP);
            $('#rfc').val(filaData.RFC);
            $('#correoRes').val(filaData.correo);
            $('#telefonoRes').val(filaData.Telefono);
            $('#telefonoResponsable').val(filaData.Telefono);
            $('#extension').val(filaData.Extension);
            // Actualizar el campo "activoRes" según el valor de "activo"
            if (filaData.activo == 1) {
              $('#activoRes').prop('checked', true);  
            } else {
              $('#activoRes').prop('checked', false);  
            }
            // Desactivar todos los campos del formulario
            $('#nombreRes, #apellidoPRes, #apellidoMRes, #curpRes, #rfc, #correoRes, #telefonoRes, #telefonoResponsable, #extension')
            .prop('disabled', true); 
          }
          // Boton para refrescar la tabla
          $('#btnRefrescarTablaRes').click(function() {
            mostrarSpinner();  
            cargarTablaRes("select * from AG_Usuarios where id_cat_user='RespGenInfo'", "#tablaRes");
          });
          // Botón de quitar seleccion en la tabla
          $('#btnQuitarSeleccionRes').click(function() {
            $('tr').removeClass('seleccionada');  
            $('#nombreRes').val('');
            $('#apellidoPRes').val('');
            $('#apellidoMRes').val('');
            $('#curpRes').val('');
            $('#rfc').val('');
            $('#correoRes').val('');
            $('#telefonoRes').val('');
            $('#telefonoResponsable').val('');
            $('#extension').val('');
            $('#activoRes').prop('checked', false);
            // Habilitar los campos del formulario
            $('#nombreRes, #apellidoPRes, #apellidoMRes, #curpRes, #rfc, #correoRes, #telefonoResponsable, #telefonoRes, #extension, #activoRes')
            .prop('disabled', false);  
          });
          // agregar responsable
          $('#btnAgregarRes').click(function() {
            // Verificar si los campos están desactivados
            if ($('#nombreRes').prop('disabled')) {
              // Activar los campos y limpiar su contenido
              $('#nombreRes, #apellidoPRes, #apellidoMRes, #curpRes, #rfc, #correoRes, #telefonoResponsable, #telefonoRes, #extension, #activoRes')
              .prop('disabled', false) 
              .val(''); 
              $('#activoRes').prop('checked', false); 
              // Eliminar la selección en la tabla
              $('tr.seleccionada').removeClass('seleccionada');  
            }
            // Verificar si los campos obligatorios están vacíos
            var nombre = $('#nombreRes').val().trim();
            var apellidoP = $('#apellidoPRes').val().trim();
            var apellidoM = $('#apellidoMRes').val().trim();
            var curp = $('#curpRes').val().trim();
            var rfc = $('#rfc').val().trim();
            var correo = $('#correoRes').val().trim();
            var telefono = $('#telefonoResponsable').val().trim();
            var extension = $('#extension').val().trim();
            // Si alguno de los campos obligatorios está vacío, mostrar el modal
            if (!nombre || !apellidoP || !apellidoM || !curp || !rfc || !correo || !telefono || !extension) {
              $('#modalAgregarDatos').modal('show');
              setTimeout(function() {
                $('#modalAgregarDatos').modal('hide');  
              }, 5000);  
            } else {
              google.script.run.insertarUsuarioResponsable(nombre, apellidoP, apellidoM, curp, rfc, correo, telefono, extension);
              cargarTablaRes("select * from AG_Usuarios where id_cat_user='RespGenInfo'", "#tablaRes");
            }
          });
          //Actualizar responsable
          $(document).ready(function() {
            $('#btnActualizarRes').click(function() {
              var idUsuario = $('tr.seleccionada').data('id');
              var activo = $('#activoRes').prop('checked') ? 1 : 0; 
              if (idUsuario) {
                google.script.run.actualizarResponsable(idUsuario, activo);
                // Recargar la tabla después de actualizar el registro
                cargarTablaRes("select * from AG_Usuarios where id_cat_user='RespGenInfo'", "#tablaRes");
              } else {
                alert('Por favor, selecciona un usuario de la tabla.');
              }
            });
          });
          //------------ DAR DE ALTA A RESPONSABLE -------------
          $('#btnAltaRes').click(function() {
            var idUsuario = $('tr.seleccionada').data('id');

            if (idUsuario) {
              var consulta = "UPDATE AG_Usuarios SET activo = 1 WHERE id_usuario = " + idUsuario;
              google.script.run.peticion(consulta);
              cargarTablaRes("select * from AG_Usuarios where id_cat_user='RespGenInfo'", "#tablaRes");
            } else {
              alert('Por favor, selecciona un usuario de la tabla.');
            }
          });
          // Cargar la tabla inicial
          cargarTablaRes("select * from AG_Usuarios where id_cat_user='RespGenInfo'", "#tablaRes");
        });
//---------------------------- CONCESIONES -----------------------------------
        $(document).ready(function() {
          var idConcesionSeleccionada = null;
          // Función para mostrar el spinner
          function mostrarSpinner() {
            $('#loadingSpinner').show();
          } 
          // Función para ocultar el spinner
          function ocultarSpinner() {
            $('#loadingSpinner').hide();
          }
          // Función para limpiar los campos del formulario
          function limpiarCampos() {
            $('#titulo').val('');
            $('#nombreLote').val('');
            $('#superficie').val('');
            $('#municipio').val('');
            $('#estado').val('');
            $('#concesionario').val('');
            $('#fechaExpedicion').val('');
            $('#fechaVigencia').val('');
            $('#agrupamiento').val('');
            $('#cabezaGrupo').val('');
            $('#proyecto').val('');
            $('#responsable').val('');
            idConcesionSeleccionada = null; // Limpiar la selección
          }
          // Función para convertir la fecha en formato 'yyyy-mm-dd'
          function convertirFecha(fechaStr) {
            // Extraer la parte numérica de la fecha 
            var milisegundos = parseInt(fechaStr.replace("/Date(", "").replace(")/", ""), 10);
            var fecha = new Date(milisegundos);

            // Extraer los componentes de la fecha (Año, Mes, Día)
            var anio = fecha.getFullYear();
            var mes = ("0" + (fecha.getMonth() + 1)).slice(-2); // Meses son 0-11
            var dia = ("0" + fecha.getDate()).slice(-2); // Aseguramos que tenga dos dígitos

            // Devolver la fecha en formato yyyy-mm-dd
            return `${anio}-${mes}-${dia}`;
          }

          // Función para cargar la tabla de concesiones
          function cargarTablaConcesiones(query, targetElement) {
            google.script.run.withSuccessHandler(function(data) {
              $(targetElement).empty(); 
              if (data.length > 0) {
                var tabla = $('<table>', { class: 'table table-bordered table-responsive' });
                var thead = $('<thead>');
                var tbody = $('<tbody>');

                var encabezados = [
                  { campo: 'id_concesion', texto: 'ID' },
                  { campo: 'titulo', texto: 'Titulo' },
                  { campo: 'nombre_lote', texto: 'Nombre lote' },
                  { campo: 'superficie', texto: 'Superficie' },
                  { campo: 'municipio', texto: 'Municipio' },
                  { campo: 'estado', texto: 'Estado' },
                  { campo: 'concesionario', texto: 'Concesionario' },
                  { campo: 'expedicion', texto: 'Expedición' },
                  { campo: 'vigencia', texto: 'Vigencia' },
                  { campo: 'agrupamiento', texto: 'Agrupamiento' },
                  { campo: 'cabeza_grupo', texto: 'Cabeza de grupo' },
                  { campo: 'proyecto', texto: 'Proyecto' },
                  { campo: 'responsable', texto: 'Responsable' }
                ];

                // Crear fila de encabezados
                var trEncabezados = $('<tr>');
                encabezados.forEach(function(encabezado) {
                  trEncabezados.append($('<th>').text(encabezado.texto));
                });
                thead.append(trEncabezados);

                // Crear filas de datos
                data.forEach(function(fila) {
                  var trFila = $('<tr>').attr('data-id', fila.id_concesion);

                  // Asignar valores de las filas a cada columna
                  encabezados.forEach(function(encabezado) {
                    var valor = fila[encabezado.campo];

                    // Formatear las fechas
                    if (encabezado.campo === 'expedicion' || encabezado.campo === 'vigencia') {
                      valor = convertirFecha(valor);
                    }

                    trFila.append($('<td>').text(valor));
                  });

                  // Manejar el evento de selección de la fila
                  trFila.click(function() {
                    seleccionarFila(this, fila);
                  });

                  tbody.append(trFila);
                });

                tabla.append(thead).append(tbody);
                $(targetElement).append(tabla);
              }

              ocultarSpinner(); // Ocultar el spinner una vez que los datos estén cargados
            }).peticion(query);
          }

          // Función para seleccionar la fila
          function seleccionarFila(filaElement, filaData) {
            $('tr').removeClass('seleccionada');  // Limpiar selección previa
            $(filaElement).addClass('seleccionada');  // Marcar la fila seleccionada

            console.log('ID Concesión seleccionada:', filaData.id_concesion);

            //   Actualizar la variable global idConcesionSeleccionada
            idConcesionSeleccionada = filaData.id_concesion;

            // Actualizar los campos del formulario con los valores de la fila seleccionada
            $('#titulo').val(filaData.titulo);
            $('#nombreLote').val(filaData.nombre_lote);
            $('#superficie').val(filaData.superficie);  
            $('#municipio').val(filaData.municipio);
            $('#estado').val(filaData.estado);
            $('#concesionario').val(filaData.concesionario);

            // Convertir las fechas a formato yyyy-mm-dd
            $('#fechaExpedicion').val(convertirFecha(filaData.expedicion));
            $('#fechaVigencia').val(convertirFecha(filaData.vigencia));

            $('#agrupamiento').val(filaData.agrupamiento);
            $('#cabezaGrupo').val(filaData.cabeza_grupo);
            $('#proyecto').val(filaData.proyecto);
            $('#responsable').val(filaData.responsable);
          }
          // Botón para quitar la selección del usuario
          $('#btnQuitarSeleccionConcesion').click(function() {
            $('tr').removeClass('seleccionada'); 
            idConcesionSeleccionada = null;  // Limpiar la variable del usuario seleccionado
            $('#titulo').val('');
            $('#nombreLote').val('');
            $('#superficie').val('');
            $('#municipio').val('');
            $('#estado').val('');
            $('#concesionario').val('');
            $('#fechaExpedicion').val('');
            $('#fechaVigencia').val('');
            $('#agrupamiento').val('');
            $('#cabezaGrupo').val('');
            $('#proyecto').val('');
            $('#responsable').val('');
          });
          $('#btnLimpiarCampos').click(function() {
            $('#titulo').val('');
            $('#nombreLote').val('');
            $('#superficie').val('');
            $('#municipio').val('');
            $('#estado').val('');
            $('#concesionario').val('');
            $('#fechaExpedicion').val('');
            $('#fechaVigencia').val('');
            $('#agrupamiento').val('');
            $('#cabezaGrupo').val('');
            $('#proyecto').val('');
            $('#responsable').val('');
          });

          $('#btnRefrescarTablaConcesiones').click(function() {
            mostrarSpinner(); // Mostrar el spinner mientras se carga la tabla
            cargarTablaConcesiones("select * from AG_ConcesionesMineras", "#tablaConcesiones");
          });

          // Botón Agregar Nueva Concesión
          $('#btnAgregarConcesion').click(function() {
            var titulo = $('#titulo').val();
            var nombreLote = $('#nombreLote').val();
            var superficie = $('#superficie').val();
            var municipio = $('#municipio').val();
            var estado = $('#estado').val();
            var concesionario = $('#concesionario').val();
            var expedicion = $('#fechaExpedicion').val();
            var vigencia = $('#fechaVigencia').val();
            var agrupamiento = $('#agrupamiento').val();
            var cabezaGrupo = $('#cabezaGrupo').val();
            var proyecto = $('#proyecto').val();
            var responsable = $('#responsable').val(); // Capturamos el campo responsable
            mostrarSpinner();
            // Validar que no haya campos vacíos
            if (titulo && nombreLote && superficie && municipio && estado && concesionario && expedicion && vigencia && agrupamiento && cabezaGrupo && proyecto && responsable) {
              google.script.run.withSuccessHandler(function(){
          
              // Lógica para cargar la tabla después de agregar la nueva concesión
              cargarTablaConcesiones("select * from AG_ConcesionesMineras", "#tablaConcesiones");
              limpiarCampos(); // Limpiar los campos del formulario después de agregar

            }).insertarConcesion(titulo, nombreLote, superficie, municipio, estado, concesionario, expedicion, vigencia, agrupamiento, cabezaGrupo, proyecto, responsable);
            } else {
              alert('Por favor completa todos los campos.');
            }
          });
          // Botón Editar Concesión
          $('#btnEditarConcesion').click(function() {
            if (idConcesionSeleccionada) {
              var titulo = $('#titulo').val();
              var nombreLote = $('#nombreLote').val();
              var superficie = $('#superficie').val();
              var municipio = $('#municipio').val();
              var estado = $('#estado').val();
              var concesionario = $('#concesionario').val();
              var expedicion = $('#fechaExpedicion').val();
              var vigencia = $('#fechaVigencia').val();
              var agrupamiento = $('#agrupamiento').val();
              var cabezaGrupo = $('#cabezaGrupo').val();
              var proyecto = $('#proyecto').val();
              var responsable = $('#responsable').val(); 
              mostrarSpinner(); // Mostrar el spinner mientras se actualiza
              google.script.run.withSuccessHandler(function() {
                // Recargar la tabla después de editar la concesión
                cargarTablaConcesiones("select * from AG_ConcesionesMineras", "#tablaConcesiones");
                limpiarCampos();
              }).editarConcesion(idConcesionSeleccionada, titulo, nombreLote, superficie, municipio, estado, concesionario, expedicion, vigencia, agrupamiento, cabezaGrupo, proyecto, responsable); // Pasamos responsable
            } else {
                alert('Por favor selecciona una concesión de la tabla.');
            }
          });
          // Botón Eliminar Concesión
          $('#btnEliminarConcesion').click(function() {
            if (idConcesionSeleccionada) {
              if (confirm('¿Estás seguro de eliminar esta concesión?')) {
                mostrarSpinner(); // Mostrar el spinner mientras se elimina
                google.script.run.withSuccessHandler(function() {
                  // Recargar la tabla después de eliminar la concesión
                  cargarTablaConcesiones("select * from AG_ConcesionesMineras", "#tablaConcesiones");
                  // Limpiar los campos del formulario
                  limpiarCampos();
                }).eliminarConcesion(idConcesionSeleccionada);
              }
            } else {
              alert('Por favor selecciona una concesión de la tabla.');
            }
          });
          // Cargar la tabla inicialmente
          cargarTablaConcesiones("select * from AG_ConcesionesMineras", "#tablaConcesiones");
        });



//----------------------------------  POR TIPO DE INFORME BUSCADOR  --------------------------------------------------
        $(document).ready(function() {
          function mostrarSpinner() {
            $('#loadingSpinner').show();
          }
          function ocultarSpinner() {
            $('#loadingSpinner').hide();
          }
          function convertirFecha(fechaStr) {
            var milisegundos = parseInt(fechaStr.replace("/Date(", "").replace(")/", ""), 10);
            var fecha = new Date(milisegundos);
            var anio = fecha.getFullYear();
            var mes = ("0" + (fecha.getMonth() + 1)).slice(-2);
            var dia = ("0" + fecha.getDate()).slice(-2);
            return `${anio}-${mes}-${dia}`;
          }

          function calcularAntiguedad(fechaInicio) {
            var hoy = new Date();
            var inicio = new Date(fechaInicio);
            var antiguedad = hoy.getFullYear() - inicio.getFullYear();
            return antiguedad;
          }

          function actualizarEstadoVigencia(inicio, fin) {
            var hoy = new Date();
            var fechaInicio = new Date(inicio);
            var fechaFin = new Date(fin);
            var diferenciaAnios = fechaFin.getFullYear() - hoy.getFullYear();

            if (hoy < fechaFin) {
              if (diferenciaAnios > 5) {
                $('#estadoVigenciaBuscador').text("Vigente").css("color", "green");
              } else {
                $('#estadoVigenciaBuscador').text("Vigencia por Finalizar").css("color", "orange");
              }
            } else {
              $('#estadoVigenciaBuscador').text("Vigencia Finalizada").css("color", "red");
            }
          }
          function cargarConcesionesIniciales() {
            var consulta = "SELECT nombre_lote FROM AG_ConcesionesMineras";
            google.script.run.withSuccessHandler(function(data) {
              $('#nombreConcesion').empty();
              $('#nombreConcesion').append('<option value="" disabled selected>Seleccionar una concesión</option>');
              data.sort(function(a, b) {
                var nombreA = a.nombre_lote.toUpperCase(); // Convertir a mayúsculas para evitar diferencias por minúsculas/mayúsculas
                var nombreB = b.nombre_lote.toUpperCase(); 
                if (nombreA < nombreB) return -1;
                if (nombreA > nombreB) return 1;
                return 0; 
              });
              if (data.length > 0) {
                data.forEach(function(fila) {
                  var option = $('<option>', { value: fila.nombre_lote }).text(fila.nombre_lote);
                  $('#nombreConcesion').append(option);
                });
              } else {
                $('#nombreConcesion').append('<option>No se encontraron concesiones</option>');
              }
              ocultarSpinner();
            }).peticion(consulta);
          }

          function buscarConcesion() {
            var nombreLoteBuscar = $('#nombreLoteBuscar').val();
            if (nombreLoteBuscar) {
              var consulta = "SELECT nombre_lote FROM AG_ConcesionesMineras WHERE nombre_lote LIKE '%" + nombreLoteBuscar + "%' OR titulo LIKE '%" + nombreLoteBuscar + "%'";
              google.script.run.withSuccessHandler(function(data) {
                $('#nombreConcesion').empty();
                $('#nombreConcesion').append('<option value="" disabled selected>Seleccionar una concesión</option>');
                data.sort(function(a, b) {
                  var nombreA = a.nombre_lote.toUpperCase(); // Convertir a mayúsculas para evitar diferencias por minúsculas/mayúsculas
                  var nombreB = b.nombre_lote.toUpperCase(); 
                  if (nombreA < nombreB) return -1;
                  if (nombreA > nombreB) return 1;
                  return 0; 
                });
                if (data.length > 0) {
                  data.forEach(function(fila) {
                    var option = $('<option>', { value: fila.nombre_lote }).text(fila.nombre_lote);
                    $('#nombreConcesion').append(option);
                  });
                } else {
                  alert("No se encontraron concesiones");
                }
                ocultarSpinner();
              }).peticion(consulta);
            } else {
              mostrarSpinner();
              cargarConcesionesIniciales();
            }
          }

          function cargarDetallesConcesion() {
            var nombreConcesionSeleccionada = $('#nombreConcesion').val();
            if (nombreConcesionSeleccionada) {
              var consulta = "SELECT * FROM AG_ConcesionesMineras WHERE nombre_lote = '" + nombreConcesionSeleccionada + "'";
              google.script.run.withSuccessHandler(function(data) {
                if (data.length > 0) {
                  var concesion = data[0];
                  $('#tituloBuscador').text(concesion.titulo || "N/A").css("font-weight", "bold");
                  $('#nombreLoteBuscador').text(concesion.nombre_lote || "N/A").css("font-weight", "bold");
                  $('#superficieBuscador').text(concesion.superficie || "N/A").css("font-weight", "bold");
                  $('#municipioBuscador').text(concesion.municipio || "N/A").css("font-weight", "bold");
                  $('#estadoBuscador').text(concesion.estado || "N/A").css("font-weight", "bold");
                  $('#concesionarioBuscador').text(concesion.concesionario || "N/A").css("font-weight", "bold");
                  var inicioV = convertirFecha(concesion.expedicion);
                  var finV = convertirFecha(concesion.vigencia);
                  $('#inicioVBuscador').text(inicioV).css("font-weight", "bold");
                  $('#finVBuscador').text(finV).css("font-weight", "bold");
                  $('#agrupamientoBuscador').text(concesion.agrupamiento || "N/A").css("font-weight", "bold");
                  $('#cabezaGrupoBuscador').text(concesion.cabeza_grupo || "N/A").css("font-weight", "bold");
                  $('#proyectoBuscador').text(concesion.proyecto || "N/A").css("font-weight", "bold");
                  $('#responsableBuscador').text(concesion.responsable || "N/A").css("font-weight", "bold");
                  $('#superficieBuscador').text(concesion.superficie || "N/A").css("font-weight", "bold");
                  $('#agrupamientoBuscador1').text(concesion.agrupamiento || "N/A").css("font-weight", "bold");
                  $('#agrupamientoBuscador2').text(concesion.agrupamiento || "N/A").css("font-weight", "bold");

                  // Calcular antigüedad y estado de vigencia
                  $('#antiguedadBuscador').text(calcularAntiguedad(inicioV)).css("font-weight", "bold");
                  actualizarEstadoVigencia(inicioV, finV);
                }
                ocultarSpinner();
              }).peticion(consulta);
            }
          }

          cargarConcesionesIniciales();
          $('#btnBuscarConcesion').click(function() {
            mostrarSpinner();
            buscarConcesion();
          });
          $('#nombreConcesion').change(function() {
            mostrarSpinner();
            cargarDetallesConcesion();
          });
        });
//-------------------------------- CONCECIONES CON INVERSION ---------------------



//-------------------------------- CONCESIONES CON PRODUCCION --------------------



//-------------------------------- CONCESIONES CON SUSPENSION --------------------


//----------------------------- INFORMES -------------------------------------
        $(document).ready(function() {
          function mostrarSpinner() {
            $('#loadingSpinner').show();
          }
          function ocultarSpinner() {
            $('#loadingSpinner').hide();
          }
          function convertirFecha(fechaStr) {
            var milisegundos = parseInt(fechaStr.replace("/Date(", "").replace(")/", ""), 10);
            var fecha = new Date(milisegundos);
            var anio = fecha.getFullYear();
            var mes = ("0" + (fecha.getMonth() + 1)).slice(-2);
            var dia = ("0" + fecha.getDate()).slice(-2);
            return `${anio}-${mes}-${dia}`;
          }

          function calcularAntiguedad(fechaInicio) {
            var hoy = new Date();
            var inicio = new Date(fechaInicio);
            var antiguedad = hoy.getFullYear() - inicio.getFullYear();
            return antiguedad;
          }

          function actualizarEstadoVigencia(inicio, fin) {
            var hoy = new Date();
            var fechaInicio = new Date(inicio);
            var fechaFin = new Date(fin);
            var diferenciaAnios = fechaFin.getFullYear() - hoy.getFullYear();

            if (hoy < fechaFin) {
              if (diferenciaAnios > 5) {
                $('#estadoVigenciaBuscador1').text("Vigente").css("color", "green");
              } else {
                $('#estadoVigenciaBuscador1').text("Vigencia por Finalizar").css("color", "orange");
              }
            } else {
              $('#estadoVigenciaBuscador1').text("Vigencia Finalizada").css("color", "red");
            }
          }
          function cargarConcesionesIniciales() {
            var consulta = "SELECT nombre_lote FROM AG_ConcesionesMineras";
            google.script.run.withSuccessHandler(function(data) {
              $('#nombreConcesion1').empty();
              $('#nombreConcesion1').append('<option value="" disabled selected>Seleccionar una concesión</option>');
              data.sort(function(a, b) {
                var nombreA = a.nombre_lote.toUpperCase(); // Convertir a mayúsculas para evitar diferencias por minúsculas/mayúsculas
                var nombreB = b.nombre_lote.toUpperCase(); 
                if (nombreA < nombreB) return -1;
                if (nombreA > nombreB) return 1;
                return 0; 
              });
              if (data.length > 0) {
                data.forEach(function(fila) {
                  var option = $('<option>', { value: fila.nombre_lote }).text(fila.nombre_lote);
                  $('#nombreConcesion1').append(option);
                });
              } else {
                $('#nombreConcesion1').append('<option>No se encontraron concesiones</option>');
              }
              ocultarSpinner();
            }).peticion(consulta);
          }

          function buscarConcesion() {
            var nombreLoteBuscar = $('#nombreLoteBuscar1').val();
            if (nombreLoteBuscar) {
              var consulta = "SELECT nombre_lote FROM AG_ConcesionesMineras WHERE nombre_lote LIKE '%" + nombreLoteBuscar + "%' OR titulo LIKE '%" + nombreLoteBuscar + "%'";
              google.script.run.withSuccessHandler(function(data) {
                $('#nombreConcesion1').empty();
                $('#nombreConcesion1').append('<option value="" disabled selected>Seleccionar una concesión</option>');
                data.sort(function(a, b) {
                  var nombreA = a.nombre_lote.toUpperCase(); // Convertir a mayúsculas para evitar diferencias por minúsculas/mayúsculas
                  var nombreB = b.nombre_lote.toUpperCase(); 
                  if (nombreA < nombreB) return -1;
                  if (nombreA > nombreB) return 1;
                  return 0; 
                });
                if (data.length > 0) {
                  data.forEach(function(fila) {
                    var option = $('<option>', { value: fila.nombre_lote }).text(fila.nombre_lote);
                    $('#nombreConcesion1').append(option);
                  });
                } else {
                  alert("No se encontraron concesiones");
                }
                ocultarSpinner();
              }).peticion(consulta);
            } else {
              mostrarSpinner();
              cargarConcesionesIniciales();
            }
          }

          function cargarDetallesConcesion() {
            var nombreConcesionSeleccionada = $('#nombreConcesion1').val();
            if (nombreConcesionSeleccionada) {
              var consulta = "SELECT * FROM AG_ConcesionesMineras WHERE nombre_lote = '" + nombreConcesionSeleccionada + "'";
              google.script.run.withSuccessHandler(function(data) {
                if (data.length > 0) {
                  var concesion = data[0];
                  $('#tituloBuscador1').text(concesion.titulo || "N/A").css("font-weight", "bold");
                  $('#nombreLoteBuscador1').text(concesion.nombre_lote || "N/A").css("font-weight", "bold");
                  $('#superficieBuscador1').text(concesion.superficie || "N/A").css("font-weight", "bold");
                  $('#municipioBuscador1').text(concesion.municipio || "N/A").css("font-weight", "bold");
                  $('#estadoBuscador1').text(concesion.estado || "N/A").css("font-weight", "bold");
                  $('#concesionarioBuscador1').text(concesion.concesionario || "N/A").css("font-weight", "bold");
                  var inicioV = convertirFecha(concesion.expedicion);
                  var finV = convertirFecha(concesion.vigencia);
                  $('#inicioVBuscador1').text(inicioV).css("font-weight", "bold");
                  $('#finVBuscador1').text(finV).css("font-weight", "bold");
                  $('#agrupamientoBuscador1').text(concesion.agrupamiento || "N/A").css("font-weight", "bold");
                  $('#cabezaGrupoBuscador1').text(concesion.cabeza_grupo || "N/A").css("font-weight", "bold");
                  $('#proyectoBuscador1').text(concesion.proyecto || "N/A").css("font-weight", "bold");
                  $('#responsableBuscador1').text(concesion.responsable || "N/A").css("font-weight", "bold");
                  $('#superficieBuscador1').text(concesion.superficie || "N/A").css("font-weight", "bold");
                  $('#agrupamientoBuscador3').text(concesion.agrupamiento || "N/A").css("font-weight", "bold");
                  $('#agrupamientoBuscador4').text(concesion.agrupamiento || "N/A").css("font-weight", "bold");

                  // Calcular antigüedad y estado de vigencia
                  $('#antiguedadBuscador1').text(calcularAntiguedad(inicioV)).css("font-weight", "bold");
                  actualizarEstadoVigencia(inicioV, finV);
                }
                ocultarSpinner();
              }).peticion(consulta);
            }
          }

          cargarConcesionesIniciales();
          $('#btnBuscarConcesion1').click(function() {
            mostrarSpinner();
            buscarConcesion();
          });
          $('#nombreConcesion1').change(function() {
            mostrarSpinner();
            cargarDetallesConcesion();
          });
        });
//------------------------------         REPORTES      ------------------------------------------



//---------------------------------------------------------------------------
      </script>
    </head>
    <body>
      <div id="scrollButton" class="scroll-btn"> 
        <i class="fas fa-arrow-circle-down" style="color: #ffffff;"></i>
      </div>
      <!-- Página de Inicio de Sesión -->
      <!-- Banner -->
      <div class="container-fluid banner">
        <!-- Carrusel a la izquierda -->
        <div class="carousel-container">
          <div id="carouselExample" class="carousel slide h-100" data-bs-ride="carousel">
            <div class="carousel-inner h-100">
              <div class="carousel-item active">
                <img src="https://www.autlan.com.mx/wp-content/uploads/2019/01/autlan-logo.png" class="d-block w-100 h-100" alt="Imagen 1">
              </div>
              <div class="carousel-item">
                <img src="https://diarioenfoque.com/gallery/01oct20202048.jpg" class="d-block w-100 h-100" alt="Imagen 2">
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>
        <!-- Contenido a la derecha -->
        <div class="content-container">
          <p class="lead" id="descripcionInfo" name="descripcionInfo">Información a tomar en cuenta.</p> 
        </div>
      </div>
      <div id="login" class="login-container">
        <div class="card card-login">
          <div class="card-body">
            <h3 class="text-center mb-4">Iniciar sesión</h3>
            <form id="login-form">
              <div class="mb-3">
                <label for="username" class="animate__animated animate__bounce">Usuario</label>
                <input
                  type="text"
                  class="form-control"
                  id="username"
                  placeholder="Introduce tu usuario"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="password" class="animate__animated animate__bounce">Contraseña</label>
                <input
                  type="password"
                  class="form-control"
                  name="password"
                  id="password"
                  placeholder="Introduce tu contraseña"
                  required
                />
                <input type="checkbox" id="mostrarPassword"> Mostrar contraseña
              </div>
              <button type="submit" class="btn btn-primary">
                Iniciar sesión
              </button>
              <div class="position-absolute" style="bottom: 20px; right: 20px;">

              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- Panel -->
      <div id="dashboard" style="display: none;">
        <div class="container-fluid mt-4">
          <!-- Barra de navegación -->
            <nav class="navbar navbar-expand-lg navbar-dark mb-4">
              <a class="navbar-brand" href="#">Control de inversiones</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav"  aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Menú de Secciones
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                      <li><a class="dropdown-item" href="#" onclick="handleSectionClick('usuariosForm');">Usuarios</a></li>
                      <li><a class="dropdown-item" href="#" onclick="handleSectionClick('responsablesForm');">Alta Responsables</a></li>
                      <li><a class="dropdown-item" href="#" onclick="handleSectionClick('catGenForm');">Catálogo General</a></li>
                      <li><a class="dropdown-item" href="#" onclick="handleSectionClick('tipoInformeForm');">Por Tipo de Informe</a></li>
                      <li><a class="dropdown-item" href="#" onclick="handleSectionClick('reportGenForm');">Reportes Generales</a></li>
                    </ul>
                  </li>
                </ul>
                <a class="nav-link logout-btn" href="#" id="logout">Cerrar sesión
                  <i class="fas fa-sign-out-alt fa-lg" style="color: #ff0000;"></i>
                </a>
              </div>
            </nav>
            <!-- Contenedor de formularios -->
            <div class="col-md-12">
              <div class="container mt-5">
                <div id="usuariosForm" class="form-container">
                  <h3 class="text-center">Lista de Usuarios</h3>
                                  <div id="tablaUsuarios" class="table-responsive"></div>
                                  <div id="tablaUsers" class="table-responsive"></div>
                  <div class="row">
                    <div class="col">
                    </div>
                    <div class="col">
                      <button type="button" class="btn btn-warning" id="btnRefrescarTablaUsuarios">Refrescar Tabla
                      <i class="fas fa-sync-alt fa-lg" style="color: #ffffff;"></i>
                    </button>
                    </div>
                    <div class="col">
                      <button type="button" class="btn btn-warning" id="btnQuitarSeleccionUsuario">Quitar Seleccion
                        <i class="fas fa-user-times fa-lg" style="color: #ffffff;"></i>                    
                      </button>
                    </div>
                    <div class="col">
                    </div>
                  </div>
                  <br>
                  <br>
                  <div id="usuarios-form">
                    <h3>Administración de Usuarios</h3>
                    <div class="wizard-header">
                    <div class="step active" data-step="1">Paso 1</div>
                    <div class="step" data-step="2">Paso 2</div>
                    <div class="step" data-step="3">Paso 3</div>
                  </div> 
                        <div class="wizard-content" id="step-1">
                          <h5>Paso 1: Información Personal</h5>
                          <div class="row">
                          <div class="col">
                            <label for="nombre" class="form-label">Nombre(s)</label>
                            <input
                              type="text"
                              class="form-control"
                              name="nombre"
                              id="nombre"
                              placeholder="Introduce el nombre"
                              required
                            />
                          </div>
                          <div class="col">
                            <label for="apellidoPaterno" class="form-label">Apellido Paterno</label>
                            <input
                              type="text"
                              class="form-control"
                              id="apellidoPaterno"
                              placeholder="Introduce el apellido paterno"
                              required
                            />
                          </div>
                          <div class="col">
                            <label for="apellidoMaterno" class="form-label">Apellido Materno</label>
                            <input
                              type="text"
                              class="form-control"
                              id="apellidoMaterno"
                              placeholder="Introduce el apellido materno"
                            />
                          </div>
                          </div>
                          <div class="mb-3">
                            <label for="correo" class="form-label">Correo</label>
                            <input
                              type="email"
                              class="form-control"
                              name="correoUsuario"
                              id="correo"
                              placeholder="Introduce el correo electrónico"
                              required
                            />
                          </div>
                          <button type="button" class="btn btn-morado next-step">Siguiente
                            <i class="fas fa-chevron-circle-right fa-lg" style="color: #000000;"></i>
                          </button>
                        </div>
                        <div class="wizard-content d-none" id="step-2">
                          <h5>Paso 2: Información Laboral</h5>
                          <div class="mb-3">
                            <label for="puesto" class="form-label">Puesto</label>
                            <input
                              type="text"
                              class="form-control"
                              name="puestoUsuario"
                              id="puestoUsuario"
                              placeholder="Introduce el puesto"
                              required                              
                            />
                          </div>
                          <div class="row">
                            <div class="col">
                              <label for="departamento" class="form-label">Departamento</label>
                              <input
                                type="text"
                                class="form-control"
                                name="departamentoUsuario"
                                id="departamentoUsuario"
                                placeholder="Introduce el departamento"
                                required
                              />  
                            </div>
                            <div class="col">
                              <label for="rol" class="form-label">Seleccione un rol:</label>
                              <select class="form-control" id="rol" name="rol" required>
                              </select>
                            </div>
                          </div>
                          <button type="button" class="btn btn-secondary prev-step">
                            <i class="fas fa-chevron-circle-left fa-lg" style="color: #000000;"></i>Atrás
                          </button>
                          <button type="button" class="btn btn-morado next-step">Siguiente
                            <i class="fas fa-chevron-circle-right fa-lg" style="color: #000000;"></i>
                          </button>
                        </div>
                        <div class="wizard-content d-none" id="step-3">
                          <h5>Paso 3: Usuario y Contraseña</h5>
                          <div class="mb-3">
                            <label for="usuario" class="form-label">Usuario</label>
                            <input
                              type="text"
                              class="form-control"
                              name="usuario"
                              id="usuario"
                              placeholder="Introduce el usuario"
                              required
                            />
                          </div>
                          <div class="mb-3">
                            <label for="contrasena" class="form-label">Contraseña</label>
                            <input
                              type="password"
                              class="form-control"
                              name="contrasena"
                              id="contrasena"
                              placeholder="Introduce la contraseña"
                              required
                            />
                            <input type="checkbox" id="mostrarContrasena"> Mostrar contraseña
                          </div>
                          <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary prev-step">
                              <i class="fas fa-chevron-circle-left fa-lg" style="color: #000000;"></i>Atrás</button>
                            <button type="submit" class="btn btn-primary" id="btnAgregarUsuario">Agregar Usuario
                              <i class="fas fa-user-plus fa-lg"></i>
                            </button>
                          </div>
                        </div>
                  </div>
                  <div class="d-flex justify-content-between" >
                    <button type="button" class="btn btn-warning" id="btnEditarUsuario">Editar Usuario
                      <i class="fas fa-edit fa-lg" style="color: #000000;"></i>
                    </button>
                    <button type="button" class="btn btn-danger" id="btnEliminarUsuario">Eliminar Usuario
                      <i class="fas fa-user-minus fa-lg"></i>
                    </button>
                  </div>
                </div> 
                <div class="form-container" id="responsablesForm">
                  <h3 class="text-center">Listado de Responsables</h3>
                    <div id="tablaRes" class="table-responsive"></div>
                  <div class="row">
                    <div class="col">
                    </div>
                    <div class="col">
                      <button type="button" class="btn btn-warning" id="btnRefrescarTablaRes">Refrescar Tabla
                      <i class="fas fa-sync-alt fa-lg" style="color: #ffffff;"></i>
                    </button>
                    </div>
                    <div class="col">
                      <button type="button" class="btn btn-warning" id="btnQuitarSeleccionRes">Quitar Seleccion
                        <i class="fas fa-user-times fa-lg" style="color: #ffffff;"></i>                    
                      </button>
                    </div>
                    <div class="col">
                    </div>
                  </div>
                  <br>
                  <br>
                  <h3>Alta de Responsables de Generar los Informes</h3>
                  <form id="responsables-form">
                          <div class="row">
                          <div class="col">
                            <label for="telefonoResponsable" class="form-label">Teléfono</label>
                            <input
                              type="text"
                              class="form-control"
                              name="telefonoResponsable"
                              id="telefonoResponsable"
                              placeholder="Introduce el telefono"
                              required
                            />
                          </div>
                          <div class="col">
                            <label for="extension" class="form-label">Extensión</label>
                            <input
                              type="text"
                              class="form-control"
                              name="extension"
                              id="extension"
                              placeholder="Introduce la Extensión"
                              required
                            />
                          </div>
                          <div class="col">
                            <label for="correoRes" class="form-label">Correo</label>
                            <input
                              type="text"
                              class="form-control"
                              name="correoRes"
                              id="correoRes"
                              placeholder="Introduce el correo"
                              required
                            />
                          </div>
                          </div>
                          <h3>Datos del Representante Legal</h3>
                          <div class="row">
                            <div class="col">
                            <label for="rfc" class="form-label">RFC</label>
                            <input
                              type="text"
                              class="form-control"
                              name="rfc"
                              id="rfc"
                              placeholder="Introduce el RFC"
                              required                              
                            />
                            </div>
                            <div class="col">
                              <label for="curpRes" class="form-label">CURP</label>
                              <input
                                type="text"
                                class="form-control"
                                name="curpRes"
                                id="curpRes"
                                placeholder="Introduce la CURP"
                                required                              
                              />
                            </div>
                            <div class="col">
                              <label for="telefonoRes" class="form-label">Teléfono</label>
                              <input
                                type="text"
                                class="form-control"
                                name="telefonoRes"
                                id="telefonoRes"
                                placeholder="Introduce el telefono"
                                required                              
                              />
                            </div>
                          </div>
                          <div class="row">
                            <div class="col">
                            <label for="apellidoPRes" class="form-label">Apellido Paterno</label>
                            <input
                              type="text"
                              class="form-control"
                              name="apellidoPRes"
                              id="apellidoPRes"
                              placeholder="Introduce el Apellido Paterno"
                              required                              
                            />
                            </div>
                            <div class="col">
                              <label for="apellidoMRes" class="form-label">Apellido Materno</label>
                              <input
                                type="text"
                                class="form-control"
                                name="apellidoMRes"
                                id="apellidoMRes"
                                placeholder="Introduce el Apellido Materno"
                                required                              
                              />
                            </div>
                            <div class="col">
                              <label for="nombreRes" class="form-label">Nombre (s)</label>
                              <input
                                type="text"
                                class="form-control"
                                name="nombreRes"
                                id="nombreRes"
                                placeholder="Introduce el nombre"
                                required                              
                              />
                            </div>
                          </div>
                          <div class="row">
                            <div class="col">
                            </div>
                            <div class="col">
                              <br>
                            <div class="form-check form-switch">
                              <input class="form-check-input" type="checkbox" id="activoRes">
                              <label class="form-check-label" for="activoRes"><b>Activar/Desactivar</b></label>
                            </div>
                            <br>
                            </div>
                            <div class="col">
                            </div>
                          </div>
                          <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-primary" id="btnAgregarRes">Agregar Responsable
                              <i class="fas fa-user-plus fa-lg"></i>
                            </button>
                            <button type="button" class="btn btn-warning" id="btnAltaRes">Dar de alta
                            </button>
                            <button type="button" class="btn btn-primary" id="btnActualizarRes">Actualizar
                              <i class="fas fa-sync-alt fa-lg" style="color: #ffffff;"></i>
                            </button>
                          </div>
                  </form>
                </div>                  
              </div>
              <div id="catGenForm" class="form-container">
                    <h5>Catálogo General</h5>  
                    <!-- Botones para elegir entre Concesiones o INPC -->
                    <div class="row d-flex justify-content-center">
                      <div class="col-auto">
                        <button class="btn btn-primary me-2" id="btn-concesiones">
                          Concesiones
                        </button>
                      </div>
                      <div class="col-auto">
                        <button class="btn btn-primary me-2" id="btn-inpc">
                          Montos mínimos e INPC
                        </button>
                      </div>
                    </div>

                    <!-- Contenedor para los formularios -->
                    <div
                      id="form-concesiones"
                      class="form-section"
                      style="display: none;">
                      <h3 class="text-center">Administrar Concesiones</h3>
                        <div id="concesionesForm">
                        <div class="row">
                          <div class="col">
                            <label for="titulo" class="form-label">Título</label>
                            <input
                              type="text"
                              class="form-control"
                              name="titulo"
                              id="titulo"
                              placeholder="Introduce el título"
                              required/>
                          </div>
                          <div class="col">
                            <label for="nombreLote" class="form-label">Nombre del Lote</label>
                            <input
                              type="text"
                              class="form-control"
                              name="nombreLote"
                              id="nombreLote"
                              placeholder="Introduce el nombre del lote"
                              required
                            />
                          </div>
                          <div class="col">
                            <label for="superficie" class="form-label">Superficie</label>
                            <input
                              type="text"
                              class="form-control"
                              id="superficie"
                              placeholder="Introduce la superficie"
                              required/>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <label for="municipio" class="form-label">Municipio</label>
                            <input
                              type="text"
                              class="form-control"
                              id="municipio"
                              placeholder="Introduce el municipio"
                              required/>
                          </div>
                          <div class="col">
                            <label for="estado" class="form-label">Estado</label>
                            <input
                              type="text"
                              class="form-control"
                              id="estado"
                              placeholder="Introduce el estado"
                              required    />
                          </div>
                          <div class="col">
                            <label for="concesionario" class="form-label">Concesionario</label>
                            <input
                              type="text"
                              class="form-control"
                              id="concesionario"
                              placeholder="Introduce el concesionario"
                              required/>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <label for="fechaExpedicion" class="form-label">Fecha de Expedición</label>
                            <input
                              type="date"
                              class="form-control"
                              id="fechaExpedicion"
                              name="fechaExpedicion"
                              required
                            />
                          </div>
                          <div class="col">
                            <label for="fechaVigencia" class="form-label">Fecha de Vigencia</label>
                            <input
                              type="date"
                              class="form-control"
                              id="fechaVigencia"
                              required/>  
                          </div>
                          <div class="col">
                            <label for="agrupamiento" class="form-label">Agrupamiento</label>
                            <input
                              type="text"
                              class="form-control"
                              id="agrupamiento"
                              placeholder="Introduce el agrupamiento"
                              required/>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <label for="cabezaGrupo" class="form-label">Cabeza de Grupo</label>
                            <input
                              type="text"
                              class="form-control"
                              id="cabezaGrupo"
                              placeholder="Introduce el cabeza de grupo"
                              required/>
                          </div>
                          <div class="col">
                            <label for="proyecto" class="form-label">Proyecto</label>
                            <input
                              type="text"
                              class="form-control"
                              id="proyecto"
                              placeholder="Introduce el proyecto"
                              required/>
                          </div>
                          <div class="col">
                            <label for="responsable" class="form-label">Responsable</label>
                            <input
                              type="text"
                              class="form-control"
                              id="responsable"
                              placeholder="Introduce el responsable"
                              required/>
                          </div>
                        </div>
                        <!-- Botones Concesiones-->
                        <div class="d-flex justify-content-between mt-4">
                          <button class="btn btn-primary"  id="btnAgregarConcesion">
                            Agregar Concesión
                            <i class="fas fa-plus fa-lg" style="color: #000000;"></i>
                          </button>
                          <button type="reset" class="btn btn-warning" id="btnLimpiarCampos">
                            Limpiar Campos
                            <i class="fas fa-trash-alt fa-lg"></i>
                          </button>
                          <button
                            type="button"
                            class="btn btn-warning"
                            id="btnEditarConcesion">
                            Editar Concesión
                            <i class="fas fa-edit fa-lg" style="color: #000000;"></i>
                          </button>
                          <button
                            type="button"
                            class="btn btn-danger"
                            id="btnEliminarConcesion">
                            Eliminar Concesión
                            <i class="fas fa-minus-circle fa-lg" style="color: #000000;"></i>
                          </button>
                        </div>
                        </div>
                        <div class="form-buscador">
                          <div>
                            <h3 class="text-center">Concesiones</h3>
                            <div id="tablaConcesiones" class="table-responsive"></div>
                            <div class="row">
                              <div class="col">
                              </div>
                              <div class="col">
                                <button type="button" class="btn btn-warning" id="btnRefrescarTablaConcesiones">Refrescar Tabla
                                  <i class="fas fa-sync-alt fa-lg" style="color: #ffffff;"></i>
                                </button>
                              </div>
                              <div class="col">
                                <button type="button" class="btn btn-warning" id="btnQuitarSeleccionConcesion">Quitar Seleccion
                                  <i class="fas fa-user-times fa-lg" style="color: #ffffff;"></i>                    
                                </button>
                              </div>
                              <div class="col">
                              </div>
                            </div>
                          </div>
                        </div>
                    </div>
                    <div id="form-inpc" class="form-section" style="display: none;">
                      <div class="form-buscador">
                      <h3 class="text-center">Indice Nacional de Precio al Consumidor</h3>
                      <form id="inpcForm">
                        <div class="row">
                        <div class="col">
                          <label for="periodoINPC" class="form-label">Periodo</label>
                          <select class="form-control" id="periodoINPC" name="periodoINPC" required>
                            <option value="" disabled selected>Selecciona...</option>
                            <script>
                              for (let year = 1990; year <= new Date().getFullYear(); year++) {
                              let option = document.createElement("option");
                                option.value = year;
                                option.text = year;
                                document.getElementById('periodoINPC').appendChild(option);
                              }
                            </script>
                          </select>
                        </div>
                        <div class="col">
                          <label for="inpcAnterior" class="form-label">INPC Anterior</label>
                          <input
                            type="number"
                            class="form-control"
                            id="inpcAnterior"
                            placeholder="Introduce el INPC anterior"
                            required/>
                        </div>
                        <div class="col">
                          <label for="inpcActual" class="form-label">INPC Actual</label>
                          <input
                            type="number"
                            class="form-control"
                            id="inpcActual"
                            placeholder="Introduce el INPC actual"
                            required
                            />
                        </div> 
                        </div> 
                        <div class="mb-3">
                          <button
                            type="button"
                            class="btn btn-primary"
                            id="calcularINPC">
                            Calcular INPC
                          </button>
                        </div>
                      </form>  
                      <br>
                      <h5>INPC más reciente:</h5>
                      <div id="tablaNuevoINPC" class="table-responsive"></div>
                      <h5 class="text-center">Listado de INPC</h5>
                      <div id="tablaINPC" class="table-responsive"></div>
                      <button class="btn btn-warning" id="refrescarTablaINPC">Recargar Tabla INPC</button>
                      <i class="fas fa-sync-alt fa-lg" style="color: #ffffff;"></i>
                    </div>
                    <div class="form-buscador">
                      <h5 class="text-center">Montos Minimos</h5>
                      <button class="btn btn-primary" id="btnAgregarPeriodo">Registrar nuevo periodo</button>
                      <br>
                      <label for="periodoBusquedaMM" class="form-label">Selecciona un periodo</label>
                      <select class="form-control" id="periodoBusquedaMM" name="periodoBusquedaMM" required>
                        <option value="" disabled selected>Selecciona...</option>
                        <script>
                          for (let year = 1990; year <= new Date().getFullYear(); year++) {
                            let option = document.createElement("option");
                            option.value = year;
                            option.text = year;
                            document.getElementById('periodoBusquedaMM').appendChild(option);
                          }
                        </script>
                      </select>
                      <br>
                      <br>
                      <div class="table-responsive" id="tablaMontosMinimos"></div>
                    </div>
                  </div>
              </div>
              <div id="tipoInformeForm" class="form-container">
                    <h3 class="text-center" id="tituloTiposInformes">Captura de Información y Documentación</h3>
                    <div class="row d-flex justify-content-center" id="btnsTiposInformes">
                      <div class="col-auto">
                        <button class="btn btn-primary me-2" id="btn-inversion">
                          Concesiones con Inversión
                        </button>
                      </div>
                      <div class="col-auto">
                        <button class="btn btn-primary me-2" id="btn-produccion">
                          Concesiones con Producción
                        </button>
                      </div>
                      <div class="col-auto">
                        <button class="btn btn-primary me-2" id="btn-suspension">
                          Concesiones con Suspensión 
                        </button>
                      </div>
                    </div>
                    <div class="container">
                      <div class="form-buscador">
                        <h3 class="text-center">Buscador</h3>
                        <div class="row">
                          <div class="col">
                            <label for="periodoConcesiones" class="form-label">Periodo</label>
                            <select class="form-control" id="periodoConcesiones" name="periodoConcesiones" required>
                              <option value="" disabled selected>Selecciona...</option>
                              <script>
                                for (let year = 1990; year <= new Date().getFullYear(); year++) {
                                  let option = document.createElement("option");
                                  option.value = year;
                                  option.text = year;
                                  document.getElementById('periodoConcesiones').appendChild(option);
                                }
                              </script>
                            </select>
                          </div>
                          <div class="col">
                            <label for="periodo2" class="form-label">No. o Nombre de Lote</label>
                            <input
                              type="text"
                              class="form-control"
                              id="nombreLoteBuscar"
                              name="nombreLoteBuscar"
                              placeholder="Introduce el lote"
                              required/>
                          </div>
                          <div class="col">
                            <br>
                            <button type="submit" class="btn btn-primary" id="btnBuscarConcesion" name="btnBuscarConcesion">
                              Buscar
                              <i class="fas fa-search fa-lg" style="color: #000000;"></i>
                            </button>
                          </div>
                          <div class="col">
                            
                            <label for="nombreConcesion" class="form-label">Selecciona la Concesión</label>
                            <select class="form-control" id="nombreConcesion" name="nombreConcesion" required>
                            <option value="" disabled selected>Selecciona...</option>
                          </select>
                          </div>
                        </div>
                        <br>
                        <div class="row d-flex justify-content-center">
                          <div class="col-auto">
                            <label class="form-label">Agrupamiento</label>
                            <br>
                            <label id="agrupamientoBuscador1"></label>
                          </div>
                          <div class="col-auto">
                            <label class="form-label">Cabeza Grupo</label><br>
                            <label id="cabezaGrupoBuscador"></label>
                          </div>
                        </div>
                      </div>
                      <div class="container">
                        <form class="form-buscador">
                          <h3 class="text-center">Información Detallada</h3>
                          <div class="row">
                            <div class="col">
                              <label class="form-label">Titulo</label><br>
                              <label id="tituloBuscador"></label><br><br>
                            </div>
                            <div class="col">
                              <label class="form-label">Nombre del Lote</label><br>
                              <label id="nombreLoteBuscador"></label><br>
                            </div>
                            <div class="col">
                              <label class="form-label">Superficie (ha)</label><br>
                              <label id="superficieBuscador"></label><br>
                            </div>
                            <div class="col">
                              <label class="form-label">Municipio</label><br>
                              <label id="municipioBuscador"></label><br>
                            </div>
                          </div>
                          <br>
                          <br>
                          <div class="row">
                            <div class="col">
                              <label class="form-label">Estado</label><br>
                              <label id="estadoBuscador"></label><br><br>
                            </div>
                            <div class="col">
                              <label class="form-label">Concesionario</label><br>
                              <label id="concesionarioBuscador"></label><br>
                            </div>
                            <div class="col">
                              <label class="form-label">Inicio de Vigencia</label><br>
                              <label id="inicioVBuscador"></label><br>
                            </div>
                            <div class="col">
                              <label class="form-label">Fin de Vigencia</label><br>
                              <label id="finVBuscador"></label><br>
                            </div>
                          </div>
                          <br>
                          <br>
                          <div class="row">
                            <div class="col">
                              <label class="form-label">Agrupamiento</label>
                              <br>
                              <label id="agrupamientoBuscador2"></label><br><br>
                            </div>
                            <div class="col">
                              <label class="form-label">Proyecto</label><br>
                              <label id="proyectoBuscador"></label>
                            </div>
                            <div class="col">
                              <label class="form-label">Responsable de la Inversión</label><br>
                              <label id="responsableBuscador"></label>
                            </div>
                            <div class="col">
                              <label class="form-label">Antiguedad (años)</label><br>
                              <label id="antiguedadBuscador"></label>
                            </div>
                          </div>
                          <br>
                          <br>
                          <div class="row">
                            <div class="col">
                              <label class="form-label">Monto Mínimo de Inversión ($M.N.)</label>
                              <br>
                              <label id="MMBuscador"></label>
                            </div>
                            <div class="col">
                            </div>
                            <div class="col">
                            </div>
                            <div class="col">
                              <label class="form-label">Estado de la Vigencia de la Concesión</label><br>
                              <label style="color: #229954 ;" id="estadoVigenciaBuscador"></label>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                    <div
                      id="form-inversion"
                      class="form-section"
                      style="display: none;">
                      <h3 class="text-center">Procesar Información de Concesión con Inversión</h3>
                      <form name="form-inversion">
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Descripción</label><br>
                            <textarea class="form-control mb-2" placeholder="Descripción" required></textarea>
                          </div>
                          <div class="col">
                            <label for="conceptoLeyInv" class="form-label">Seleccione el Concepto de Ley:</label>
                            <select class="form-select" id="conceptoLeyInv" name="conceptoLeyInv" required>
                              <option value="" disabled selected>Seleccione...</option>
                            </select>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Factura</label><br>
                            <input
                              type="text"
                              class="form-control"
                              id="facturaInversion"
                              placeholder="Introduce la factura"
                              required/>
                          </div>
                          <div class="col">
                            <label class="form-label">Fecha</label><br>
                            <input
                              type="date"
                              class="form-control"
                              id="fechaInversion"
                              required
                            />
                          </div>
                          <div class="col">
                            <label class="form-label">Monto</label><br>
                            <input
                              type="text"
                              class="form-control"
                              id="montoInversion"
                              placeholder="Introduce el monto de inversión"
                              required
                            />
                          </div>
                        </div>
                        <div class="mb-3" id="invCompartida">
                          <label class="form-label">¿Es una inversión compartida?</label><br>
                          <input type="radio" id="si" name="inversion_compartida" value="Si" required>
                          <label for="si">Sí</label>
                          <input type="radio" id="no" name="inversion_compartida" value="No" required>
                          <label for="no">No</label>
                        </div>
                        <div class="row" id="formInvCompartida" style="display: none;">  
                          <div class="col-4">
                            <label class="form-label">Titulo</label><br>
                            <input
                              type="text"
                              class="form-control"
                              id="tituloInversionCompartida"
                              placeholder="Introduce el titulo"
                              required/>
                          </div>
                          <div class="col-4">
                            <label for="nombreLoteCompartida" class="form-label">Nombre del Lote</label>
                            <select class="form-select" id="nombreLoteCompartida" name="nombreLoteCompartida" required>
                              <option value="" disabled selected>Seleccione...</option>
                            </select>
                          </div>
                          <div class="col-4">
                            <label class="form-label">Monto $</label><br>
                            <input
                              type="text"
                              class="form-control"
                              id="montoInversionCompartida"
                              placeholder="Introduce el monto compartido"
                              required />
                          </div>
                        </div><br>
                        <div class="d-flex justify-content-between">
                          <div class="form-group">
                            <button class="btn btn-warning" id="uploadPdfBtn">Seleccionar PDF
                              <i class="fas fa-file-pdf fa-lg" style="color: #ee2f0d;"></i>
                            </button>
                            <button class="btn btn-warning" id="uploadXmlBtn">Seleccionar XML
                              <i class="fas fa-file fa-lg" style="color: #25b828;"></i>
                            </button>
                          </div>
                          <input type="file" id="pdfFile" accept=".pdf" style="display: none;" />
                          <input type="file" id="xmlFile" accept=".xml" style="display: none;" />
                          <button type="submit" class="btn btn-primary">Guardar
                            <i class="fas fa-upload fa-lg" style="color: #000000;"></i>
                          </button>
                        </div>
                        <br><br>
                        <h3 class="text-center">¿Qué desea hacer con la inversión?<h3><br>
                        <div class="d-flex justify-content-between">
                          <button type="button" class="btn btn-warning" id="btn-nuevaInversion">Crear nueva
                            <i class="fas fa-plus fa-lg" style="color: #000000;"></i>
                          </button>
                          <button type="button" class="btn btn-warning" id="btn-modificarInversion">Modificar</button>
                          <button type="button" class="btn btn-danger" id="btn-eliminarInversion">Eliminar
                            <i class="fas fa-minus-circle fa-lg" style="color: #000000;"></i>
                          </button>
                        </div>
                        <br>
                        <div class="row">
                          <div class="col">
                            <label class="form-label"><b>Inversión Total: </b></label>
                          </div>
                          <div class="col">
                            <label class="form-label">aqui va la inversion total</label>
                          </div>
                          <div class="col">
                            <label class="form-label">inversion superada o no</label>
                          </div>
                        </div>
                      </form>
                    </div>
                    <div
                      id="form-produccion"
                      class="form-section"
                      style="display: none;">
                      <h3 class="text-center">Procesar Información de Concesión con Producción</h3>
                      <form id="form-produccion">
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Descripción</label><br>
                            <textarea class="form-control mb-2" placeholder="Descripción"></textarea>
                          </div>
                          <div class="col">
                            <label for="conceptoLeyProd" class="form-label">Seleccione el Concepto de Ley</label>
                            <select class="form-select" id="conceptoLeyProd" name="conceptoLeyProd" required>
                              <option value="" disabled selected>Seleccione...</option>
                            </select>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Fecha</label><br>
                            <input
                              type="date"
                              class="form-control"
                              id="fechaProduccion"
                              required/>
                          </div>
                          <div class="col">
                            <label class="form-label">Monto</label><br>
                            <input
                              type="text"
                              class="form-control"
                              id="montoProduccion"
                              placeholder="Introduce el monto de inversión"
                              required
                            />
                          </div>
                          <div class="col">
                            <br>
                            <button class="btn btn-warning" id="uploadPdf">Seleccionar PDF
                              <i class="fas fa-file-pdf fa-lg" style="color: #ee2f0d;"></i>
                            </button>
                            <input type="file" id="pdfF" accept=".pdf" style="display: none;" />
                          </div>
                          <div class="col">
                            <br>
                            <button type="submit" class="btn btn-primary">Guardar
                              <i class="fas fa-upload fa-lg" style="color: #000000;"></i>
                            </button>
                          </div>
                        </div>
                        <br><br>
                        <h3 class="text-center">¿Qué desea hacer con la producción?<h3><br>
                        <div class="d-flex justify-content-between">
                          <button type="button" class="btn btn-warning" id="btn-nuevaProduccion">Crear nueva
                            <i class="fas fa-plus fa-lg" style="color: #000000;"></i>
                          </button>
                          <button type="button" class="btn btn-warning" id="btn-modificarProduccion">Modificar</button>
                          <button type="button" class="btn btn-danger" id="btn-eliminarProduccion">Eliminar
                            <i class="fas fa-minus-circle fa-lg" style="color: #000000;"></i>
                          </button>
                        </div>
                        <br>
                        <div class="row">
                          <div class="col">
                            <label class="form-label"><b>Producción Total: </b></label>
                          </div>
                          <div class="col">
                            <label class="form-label">aqui va la produccion total</label>
                          </div>
                          <div class="col">
                            <label class="form-label">inversion superada o no</label>
                          </div>
                        </div>
                      </form>
                    </div>
                    <div
                      id="form-suspension"
                      class="form-section"
                      style="display: none;">
                      <h3 class="text-center">Procesar Información de Concesión con Suspensión</h3>
                      <form id="form-suspension">
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Descripción</label><br>
                            <textarea class="form-control mb-2" placeholder="Descripción"></textarea>
                          </div>
                          <div class="col">
                            <label for="conceptoLeySus" class="form-label">Seleccione el Concepto de Ley</label>
                            <select class="form-select" id="conceptoLeySus" name="conceptoLeySus" required>
                              <option value="" disabled selected>Seleccione...</option>
                            </select>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <button class="btn btn-warning" id="uploadPdfSuspension">Seleccionar PDF
                              <i class="fas fa-file-pdf fa-lg" style="color: #ee2f0d;"></i>
                            </button>
                            <input type="file" id="pdfFileSuspension" accept=".pdf" style="display: none;" />
                          </div>
                          <div class="col">
                            <button type="submit" class="btn btn-primary">Guardar
                              <i class="fas fa-upload fa-lg" style="color: #000000;"></i>
                            </button>
                          </div>
                          <div class="col">
                            <button type="button" class="btn btn-warning" id="btn-nuevaSuspension">Crear nueva
                              <i class="fas fa-plus fa-lg" style="color: #000000;"></i>
                            </button>
                          </div>
                        </div>
                      </form>
                    </div>
              </div>
              <div id="reportGenForm" class="form-container">
                    <h3 class="text-center">Informes y Reportes</h3>
                    <div class="row d-flex justify-content-center">
                      <div class="col-auto">
                        <button class="btn btn-primary me-2 text-center" id="btn-informes">Informes</button>
                      </div>
                      <div class="col-auto">
                        <button class="btn btn-primary me-2 text-center" id="btn-reportes">Reportes </button>
                      </div>
                    </div>
                    <div
                      id="form-informes"
                      class="form-section"
                      style="display: none;">
                      <form class="form-buscador">
                        <h5 class="text-center">Responsables de Generar Reportes</h5>
                        <h6>Selecciona un responsable:</h6>
                        <div id="radiosRes" class="table-responsive"></div>
                        <label id="apellidoPaternoEtiqueta"></label>
                        <label id="apellidoMaternoEtiqueta"></label>
                        <h5 class="text-center">Datos de Contacto</h5>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Teléfono</label><br>
                            <label style="color:  #2e86c1 ;" id="telefonoR"><b></b></label><br><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Extensión</label><br>
                            <label style="color:  #2e86c1 ;" id="extensionR"><b></b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Correo electrónico</label><br>
                            <label style="color:  #2e86c1 ;" id="correoR"><b></b></label><br>
                          </div>
                         </div>
                        <h5 class="text-center">Representante Legal</h5>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Nombre</label><br>
                            <label style="color: #2e86c1 ;" id="nombreRL"><b></b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Primer Apellido</label><br>
                            <label style="color: #2e86c1 ;" id="apellidoPaternoRL"><b></b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Segundo Apellido</label><br>
                            <label style="color: #2e86c1 ;" id="apellidoMaternoRL"><b></b></label><br>
                          </div> 
                        </div>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">R.F.C:</label><br>
                            <label style="color: #2e86c1 ;" id="rfcRL"><b></b></label><br>
                          </div>
                          <div class="col">
                            <label class="col">
                            <label class="form-label">CURP:</label><br>
                            <label style="color: #2e86c1 ;" id="curpRL"><b></b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Teléfono</label><br>
                            <label style="color: #2e86c1 ;" id="telefonoRL"><b></b></label><br>
                          </div>
                        </div>
                      </form>
                      <div class="form-buscador">
                        <h3 class="text-center">Buscador</h3>
                        <div class="row">
                          <div class="col">
                            <label for="" class="form-label">Periodo</label>
                            <select class="form-control" id="periodoBuscar" required>
                              <option value="" disabled selected>Selecciona...</option>
                              <script>
                                for (let year = 1990; year <= new Date().getFullYear(); year++) {
                                  let option = document.createElement("option");
                                  option.value = year;
                                  option.text = year;
                                  document.getElementById('periodoBuscar').appendChild(option);
                                }
                              </script>
                            </select>
                          </div>
                          <div class="col">
                            <label for="nombreLoteBuscar1" class="form-label">No. o Nombre de Lote</label>
                            <input
                              type="text"
                              class="form-control"
                              id="nombreLoteBuscar1"
                              placeholder="Introduce el lote"
                              required/>
                          </div>
                          <div class="col">
                            <br>
                            <button type="submit" class="btn btn-primary" id="btnBuscarConcesion1">
                              Buscar
                              <i class="fas fa-search fa-lg" style="color: #000000;"></i>
                            </button>
                          </div>
                          <div class="col">
                            <label for="concesion" class="form-label">Concesión</label>
                            <select class="form-control" id="nombreConcesion1" required>
                              <option value="" disabled selected>Selecciona...</option>
                            </select>
                          </div>
                        </div>
                        <br>
                        <div class="row flex justify-content-center">
                          <div class="col-auto">
                            <label class="form-label">Agrupamiento</label>
                            <br>
                            <label id="agrupamientoBuscador3"><b></b></label>
                          </div>
                          <div class="col-auto">
                          </div>
                          <div class="col-auto">
                            <label class="form-label">Factor Año Comprueba</label><br>
                            <label id="factorAnioBuscar"><b>aqui va el factor año</b></label>
                          </div>
                          <div class="col-auto">
                          </div>
                          <div class="col-auto">
                            <label class="form-label">Cabeza Grupo</label><br>
                            <label id="cabezaGrupoBuscador1"><b></b></label>
                          </div>
                        </div>
                      </div>
                      <div class="form-buscador">
                        <h3 class="text-center">Información Detallada</h3>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Titulo</label><br>
                            <label id="tituloBuscador1"><b></b></label><br><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Nombre del Lote</label><br>
                            <label id="nombreLoteBuscador1"><b></b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Superficie (ha)</label><br>
                            <label id="superficieBuscador1"><b></b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Municipio</label><br>
                            <label id="municipioBuscador1"><b></b></label><br>
                          </div>
                        </div>
                        <br>
                        <br>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Estado</label><br>
                            <label id="estadoBuscador1"><b></b></label><br><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Concesionario</label><br>
                            <label id="concesionarioBuscador1"><b></b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Inicio de Vigencia</label><br>
                            <label id="inicioVBuscador1"><b></b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Fin de Vigencia</label><br>
                            <label id="finVBuscador1"><b></b></label><br>
                          </div>
                        </div>
                        <br>
                        <br>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Agrupamiento</label>
                            <br>
                            <label id="agrupamientoBuscador4"><b></b></label><br><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Proyecto</label><br>
                            <label id="proyectoBuscador1"><b></b></label>
                          </div>
                          <div class="col">
                            <label class="form-label">Responsable de la Inversión</label><br>
                            <label id="responsableBuscador1"><b></b></label>
                          </div>  
                          <div class="col">
                            <label class="form-label">Antiguedad (años)</label><br>
                            <label id="antiguedadBuscador1"><b></b></label>
                          </div>
                        </div>
                        <br>
                        <br>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Monto Mínimo de Inversión ($M.N.)</label>
                            <br>
                            <label id="MMBuscador1"><b>aqui va el monto minimo</b></label>
                          </div>
                          <div class="col">
                          </div>
                          <div class="col">
                          </div>
                          <div class="col">
                            <label class="form-label">Estado de la Vigencia de la Concesión</label><br>
                            <label style="color: #229954 ;" id="estadoVigenciaBuscador1"><b></b></label>
                          </div>
                        </div>
                        <br>
                        <br>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Inversión Efectuada ($ M.N.)</label><br>
                            <label style="color: #2e86c1 ;" id="inversionEfectuada"><b>aqui va la inversion efectuada</b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Resultado de la Inversión</label><br>
                            <label style="color: #2e86c1 ;" id="resultadoInversion"><b>inversion superada o no</b></label><br>
                          </div>
                        </div>
                        <br>
                        <br>
                        <br>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Excedente por aplicar de comprobaciones anteriores:</label><br>
                          </div>
                          <div class="col">
                            <input
                              type="text"
                              class="form-control"
                              id="excedente"
                              placeholder="Introduzca el excedente"
                              required/>
                          </div>
                          <div class="col">
                            <button type="submit" class="btn btn-warning" id="btnRegistrarExcedente">
                              Registrar Excedente
                              <i class="fas fa-upload fa-lg" style="color: #000000;"></i>
                            </button>
                          </div>
                          <div class="col">
                            <label for="conceptoLeySus" class="form-label">Seleccione el Tipo de Informe</label>
                            <select class="form-select" id="tipoInformeExcedente" name="tipoInformeExcedente" required>
                              <option value="" disabled selected>Seleccione...</option>
                              <option value="Inversión">Inversión</option>
                              <option value="Producción">Producción</option>
                              <option value="Suspensión">Suspensión</option>
                            </select>
                          </div>
                        </div>
                        <br>
                        <div class="row justify-content-center" id="btnsReportesPdf">
                          <div class="col-auto">
                            <button onclick="previsualizarReportePDF()" type="submit" class="btn btn-warning" id="btnPrevisualizarReportePDF">
                              Previsualizar Reporte PDF
                              <i class="far fa-eye fa-lg" style="color: #000000;"></i>
                            </button>  
                            <script>
                              function previsualizarReportePDF() {
                                var datos = {
                                  lote: document.getElementById('nombreLoteBuscador1').textContent,
                                  fecha_dof: document.getElementById('nombreLoteBuscar1').value,
                                  fecha_recepcion: document.getElementById('nombreLoteBuscar1').value,
                                  telefono_contacto: document.getElementById('telefonoR').textContent,
                                  correo_contacto: document.getElementById('correoR').textContent,
                                  rfc_legal: document.getElementById('rfcRL').textContent,
                                  curp_legal: document.getElementById('curpRL').textContent,
                                  nombre_legal: document.getElementById('nombreRL').textContent,
                                  apep_legal: document.getElementById('apellidoPaternoRL').textContent,
                                  apem_legal: document.getElementById('apellidoMaternoRL').textContent,
                                  cel_legal: document.getElementById('telefonoR').textContent,
                                  titulo: document.getElementById('tituloBuscador1').textContent,
                                  si_check: document.getElementById('si').checked ? 'Sí' : 'No',
                                  no_check: document.getElementById('no').checked ? 'Sí' : 'No',
                                  agrupamiento: document.getElementById('agrupamientoBuscador3').textContent,
                                  anio_lote: document.getElementById('nombreLoteBuscar1').value,
                                  inicio_comp: document.getElementById('nombreLoteBuscar1').value,
                                  fin_comp: document.getElementById('nombreLoteBuscar1').value,
                                  obra_minera: document.getElementById('nombreLoteBuscar1').value,
                                  levantamientos: document.getElementById('nombreLoteBuscar1').value,
                                  analisis: document.getElementById('nombreLoteBuscar1').value,
                                  desarrollo_minero: document.getElementById('nombreLoteBuscar1').value,
                                  AMP_mineras: document.getElementById('nombreLoteBuscar1').value,
                                  AMLF_meta: document.getElementById('nombreLoteBuscar1').value,
                                  AMTV_personal: document.getElementById('nombreLoteBuscar1').value,
                                  PC_ambiente: document.getElementById('nombreLoteBuscar1').value,
                                  AOTC_trabajador: document.getElementById('nombreLoteBuscar1').value,
                                  vias_acceso: document.getElementById('nombreLoteBuscar1').value,
                                  serv_general: document.getElementById('nombreLoteBuscar1').value,
                                  ope_presas: document.getElementById('nombreLoteBuscar1').value,
                                  total: document.getElementById('nombreLoteBuscar1').value,
                                  produccion: document.getElementById('nombreLoteBuscar1').value,
                                  susp_tempo: document.getElementById('nombreLoteBuscar1').value,
                                  susp_imposibilidad: document.getElementById('nombreLoteBuscar1').value,
                                  susp_concurso: document.getElementById('nombreLoteBuscar1').value,
                                  susp_derrumbe: document.getElementById('nombreLoteBuscar1').value,
                                  excedente: document.getElementById('nombreLoteBuscar1').value,
                                  inpc_actual: document.getElementById('nombreLoteBuscar1').value,
                                  inpc_anterior: document.getElementById('nombreLoteBuscar1').value,
                                  excedente_actual: document.getElementById('nombreLoteBuscar1').value,
                                  inversion_efectuada: document.getElementById('nombreLoteBuscar1').value,
                                  total_comprobado: document.getElementById('nombreLoteBuscar1').value,
                                  monto_minimoc: document.getElementById('nombreLoteBuscar1').value,
                                  result_montof: document.getElementById('nombreLoteBuscar1').value
                                };
                                google.script.run.withSuccessHandler(function(content) {
                                  const container = document.getElementById('contenidoPDF');
                                  const shadowRoot = container.attachShadow({mode: 'open'});
                                  shadowRoot.innerHTML = content;
                                }).getPlantillaPDF(datos);  
                              }
                            </script>
                          </div>
                          <div class="col-auto">
                            <button type="submit" class="btn btn-primary" id="btnGenerarReportePDF">
                              Generar Reporte PDF
                              <i class="fas fa-file-pdf fa-lg" style="color: #ff0000;"></i>
                            </button>
                          </div>
                        </div>
                        <div id="contenidoPDF">
                        </div>
                      </div>
                      <div class="form-buscador">
                        <h3 class="text-center">Actualización de Montos($ M.N.)</h3>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Entre valor índice de precios al consumidor del mes de octubre del año inmediato anterior:
                            </label><br>
                            <label style="color: #2e86c1 ;" id="inpcAnteriorBuscador"><b>aqui va el INPC</b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Por el valor índice de precios al consumidor del mes de octubre del año que se comprueba:</label><br>
                            <label style="color: #2e86c1 ;" id="inpcActualBuscador"><b>aqui va el inpc actual</b></label>
                          </div>
                          <br>
                        </div>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Actualización del excedente por aplicar:</label><br>
                            <label style="color: #2e86c1" id="excedentePorAplicar"><b>aqui va el excedente</b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Importe total de la inversión efectuada:</label><br>
                            <label style="color: #2e86c1 ;" id="importeInversionEfectuada"><b>aqui va la inversion</b></label><br>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Total Comprobado:</label><br>
                            <label style="color: #2e86c1 ;" id="totalComprobado"><b>aqui va el total comprobado</b></label><br>
                          </div>
                          <div class="col">
                            <label class="form-label">Monto Mínimo por Comprobar:</label><br>
                            <label style="color: #2e86c1 ;" id="MMPorCombrobar"><b>aqui va el monto minimo por comprobar</b></label><br>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col">
                            <label class="form-label">Monto por aplicar en comprobaciones subsecuentes:</label><br>
                            <label style="color: #2e86c1 ;" id="montoPorAplicarSubs"><b>aqui va el monto por aplicar</b></label><br>
                          </div>
                        </div>
                      </div>
                    </div>  
                    <div id="form-reportes" 
                      class="form-section" 
                      style="display: none;">
                      <h3 class="text-center">Generación de Reportes</h3>
                      <form id="form-reportes-data">
                        <div class="mb-3">
                          <label for="periodo2" class="form-label">Periodo</label>
                          <select class="form-control" id="periodo2" required>
                            <option value="" disabled selected>Selecciona...</option>
                            <script>
                              for (let year = 1990; year <= new Date().getFullYear(); year++) {
                                let option = document.createElement("option");
                                option.value = year;
                                option.text = year;
                                document.getElementById('periodo2').appendChild(option);
                              }
                            </script>
                          </select>
                        </div>
                        <div class="row">
                          <div class="col">
                            <button type="button" class="btn btn-warning" id="btnPrevisualizarExcel">Previsualizar</button>
                          </div>
                          <div class="col">
                            <button type="button" class="btn btn-warning" id="btnGenerarExcel">Generar Excel</button>
                          </div>
                        </div>
                        <div id="previsualizacion">
                              <iframe id="iframePrevisualizacion" width="100%" height="500px" style="border: 1px solid #ccc;"></iframe>
                        </div>
                         <script>
  document.getElementById("btnPrevisualizarExcel").addEventListener("click", function () {
    google.script.run.withSuccessHandler(function (urlPdf) {
      if (urlPdf.startsWith("https")) {
        document.getElementById("iframePrevisualizacion").src = urlPdf;
      } else {
        alert("Error al generar la previsualización: " + urlPdf);
      }
    }).obtenerVistaPreviaExcel();
  });
</script>
                      </form>  
                      <div class="container mt-5">
                        <h2>Sube tu archivo Excel</h2>
                        <form id="upload-form" enctype="multipart/form-data">
                          <div class="form-group">
                            <input type="file" class="form-control-file" id="archivoExcel" accept=".xls,.xlsx">
                          </div>
                          <button type="submit" class="btn btn-primary" id="uploadExcelBtn">Subir</button>
                        </form>
                        <div class="table-container mt-5">
                          <table class="table table-bordered" id="excel-table">
                          </table>
                        </div>
                      </div>
                    </div>
              </div>
            </div>
        </div>
      </div>
          <!-- Modal de Bootstrap -->
      <div class="modal fade" id="alertModal" tabindex="-1" aria-labelledby="alertModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="alertModalLabel">Atención</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p id="modalMessage"></p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="modalAgregarDatos" tabindex="-1" role="dialog" aria-labelledby="modalAgregarDatosLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalAgregarDatosLabel">¡Atención!</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>Por favor, completa todos los campos obligatorios para agregar el registro.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            </div>
          </div>
        </div>
      </div>
      <div id="loadingSpinner" style="display:none;">
        <div class="spinner">
          <div class="dot1"></div>
          <div class="dot2"></div>
        </div>
      </div>
      <footer>
        <p>
          Contacto: <a href="mailto:@autlan.com.mx">@autlan.com.mx</a> |
          Teléfono: +231
        </p>
        <p>&copy; 2025 Autlán. Todos los derechos reservados.</p>
      </footer>
      <script>
        // inicio de sesión
        document.getElementById("login-form").addEventListener("submit", function (event) {
          event.preventDefault(); 
          var usuario = document.getElementById("username").value;
          var contrasena = document.getElementById("password").value;
          google.script.run.withSuccessHandler(function(response) {
            if (response.success) {
              document.getElementById('login').style.display = 'none';
              document.getElementById('dashboard').style.display = 'block';
              document.querySelector('.banner').style.display = 'none';
              // Asegurar que no se muestre ningun formulario activo
              document.querySelectorAll('.form-container').forEach(form => {
                form.classList.remove('active');
              });
              alert(response.message); 
              manejarAccesos(response.idRol); 
            } else {
              alert(response.message); 
            }
          }).verificarUsuario(usuario, contrasena);
        });
        function manejarAccesos(rol) {
          console.log("Rol del usuario:", rol);  
          const contenedores = [
            "btnsTiposInformes",
            "usuariosForm",
            "responsablesForm",
            "concesionesForm",
            "inpcForm",
            "btnAgregarPeriodo",
            "btnRegistrarExcedente",
            "btnsReportesPdf",
            "tituloTiposInformes"
          ];
          if (rol === 1) {
            contenedores.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
              element.classList.remove('oculto');
            }
            });
          } else if (rol === 2) {
            document.getElementById("btnsTiposInformes").classList.add('oculto');
            document.getElementById("tituloTiposInformes").classList.add('oculto');
          } else if (rol === 3) {
            document.getElementById("usuariosForm").classList.add('oculto');
            document.getElementById("responsablesForm").classList.add('oculto');
            document.getElementById("concesionesForm").classList.add('oculto');
            document.getElementById("inpcForm").classList.add('oculto');
            document.getElementById("btnAgregarPeriodo").classList.add('oculto');
            document.getElementById("btnRegistrarExcedente").classList.add('oculto');
            document.getElementById("btnsReportesPdf").classList.add('oculto');
          } else if (rol === 4) {
            document.getElementById("btnsTiposInformes").classList.add('oculto');
            document.getElementById("tituloTiposInformes").classList.add('oculto');
            document.getElementById("usuariosForm").classList.add('oculto');
            document.getElementById("responsablesForm").classList.add('oculto');
            document.getElementById("concesionesForm").classList.add('oculto');
            document.getElementById("inpcForm").classList.add('oculto');
            document.getElementById("btnAgregarPeriodo").classList.add('oculto');
            document.getElementById("btnRegistrarExcedente").classList.add('oculto');
            document.getElementById("btnsReportesPdf").classList.add('oculto');
          }
        }
        // Cerrar sesion
        document.getElementById('logout').addEventListener('click', function() {
          document.getElementById('login').style.display = 'flex';
          document.getElementById('dashboard').style.display = 'none';
          document.querySelector('.banner').style.display = 'flex'; 
          document.getElementById('username').value = '';
          document.getElementById('password').value = '';
          document.querySelectorAll('input, select').forEach(input => {
            input.value = ''; 
            input.classList.remove('is-invalid');
            input.classList.remove('is-valid'); 
          });
          document.querySelectorAll('.form-container').forEach(form => {
            form.classList.remove('active');
          });
          document.getElementById('btn-concesiones').style.opacity = 1;
          document.getElementById('btn-inpc').style.opacity = 1;
          document.getElementById('form-concesiones').style.display = 'none';
          document.getElementById('form-inpc').style.display = 'none';
          document.getElementById('btn-informes').style.opacity = 1;
          document.getElementById('btn-reportes').style.opacity = 1;
          document.getElementById('form-informes').style.display = 'none';
          document.getElementById('form-reportes').style.display = 'none';
          document.getElementById('btn-inversion').style.opacity = 1;
          document.getElementById('btn-produccion').style.opacity = 1;
          document.getElementById('btn-suspension').style.opacity = 1;
          document.getElementById('form-inversion').style.display = 'none';
          document.getElementById('form-produccion').style.display = 'none';
          document.getElementById('form-suspension').style.display = 'none';
        });
  
        function handleSectionClick(formId) {
          // Ocultar todos los formularios
          document.querySelectorAll('.form-container').forEach(form => {
            form.classList.remove('active');
          });
          // Mostrar el formulario seleccionado
          document.getElementById(formId).classList.add('active');
        }
        // Mostrar formularios segun el usuario seleccione un boton
        document.getElementById('btn-concesiones').addEventListener('click', function() {
          document.getElementById('form-concesiones').style.display = 'block';
          document.getElementById('form-inpc').style.display = 'none';
          document.getElementById('btn-inpc').style.opacity=0.5;
          document.getElementById('btn-concesiones').style.opacity=1;
        });
        document.getElementById('btn-inpc').addEventListener('click', function() {
          document.getElementById('form-inpc').style.display = 'block';
          document.getElementById('form-concesiones').style.display = 'none';
          document.getElementById('btn-inpc').style.opacity=1;
          document.getElementById('btn-concesiones').style.opacity=0.5;
        });
        document.getElementById('btn-informes').addEventListener('click', function() {
          document.getElementById('form-informes').style.display = 'block';
          document.getElementById('form-reportes').style.display = 'none';
          document.getElementById('btn-informes').style.opacity=1;
          document.getElementById('btn-reportes').style.opacity=0.5;
        });
        document.getElementById('btn-reportes').addEventListener('click', function() {
          document.getElementById('form-reportes').style.display = 'block';
          document.getElementById('form-informes').style.display = 'none';
          document.getElementById('btn-reportes').style.opacity=1;
          document.getElementById('btn-informes').style.opacity=0.5;
        });

        document.getElementById('btn-inversion').addEventListener('click', function() {
          document.getElementById('form-inversion').style.display = 'block';
          document.getElementById('form-suspension').style.display = 'none';
          document.getElementById('form-produccion').style.display = 'none';
          document.getElementById('btn-inversion').style.opacity=1;
          document.getElementById('btn-produccion').style.opacity=0.5;
          document.getElementById('btn-suspension').style.opacity=0.5;
        });
        document.getElementById('btn-produccion').addEventListener('click', function() {
          document.getElementById('form-produccion').style.display = 'block';
          document.getElementById('form-suspension').style.display = 'none';
          document.getElementById('form-inversion').style.display = 'none';
          document.getElementById('btn-produccion').style.opacity=1;
          document.getElementById('btn-suspension').style.opacity=0.5;
          document.getElementById('btn-inversion').style.opacity=0.5;
        });
        document.getElementById('btn-suspension').addEventListener('click', function() {
          document.getElementById('form-suspension').style.display = 'block';
          document.getElementById('form-inversion').style.display = 'none';
          document.getElementById('form-produccion').style.display = 'none';
          document.getElementById('btn-suspension').style.opacity=1;
          document.getElementById('btn-inversion').style.opacity=0.5;
          document.getElementById('btn-produccion').style.opacity=0.5;
        });
        document.addEventListener('DOMContentLoaded', () => {
          const steps = document.querySelectorAll('.step');
          const contents = document.querySelectorAll('.wizard-content');
          const nextButtons = document.querySelectorAll('.next-step');
          const prevButtons = document.querySelectorAll('.prev-step');
          let currentStepIndex = 0;
          // Función para mostrar el modal
        function showModal(message) {
          const modalMessage = document.getElementById('modalMessage');
          modalMessage.textContent = message; 
          const alertModal = new bootstrap.Modal(document.getElementById('alertModal'));
          alertModal.show();
        }
        // Funcion que muestra u oculta el contenedor formInvCompartida
        function toggleFormInvCompartida() {
          const formInvCompartida = document.getElementById('formInvCompartida');
          const si = document.getElementById('si');
          const no = document.getElementById('no');  
          if (si.checked) {
            formInvCompartida.style.display = 'block';
          } 
          else if (no.checked) {
            formInvCompartida.style.display = 'none';
          }
        }
        document.getElementById('si').addEventListener('change', toggleFormInvCompartida);
        document.getElementById('no').addEventListener('change', toggleFormInvCompartida);
        // Función de validación de inputs
        function validateInput(input) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          const telefonoRegex = /^[0-9]{10}$/; 
          const extensionRegex = /^[0-9]{4}$/; 
          const montoRegex = /^[0-9]+(\.[0-9]{1,4})?$/; 
          const rfcRegex = /^([A-ZÑ&]{3,4}) ?(?:- ?)?(\d{2}(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\d|3[01])) ?(?:- ?)?([A-Z\d]{2})([A\d])$/; 
          const curpRegex = /^([A-Z][AEIOUX][A-Z]{2}\d{2}(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\d|3[01])[HM](?:AS|B[CS]|C[CLMSH]|D[FG]|G[TR]|HG|JC|M[CNS]|N[ETL]|OC|PL|Q[TR]|S[PLR]|T[CSL]|VZ|YN|ZS)[B-DF-HJ-NP-TV-Z]{3}[A-Z\d])(\d)$/; 
          // No hacer nada si el campo es username o password
          if (input.id === 'username' || input.id === 'password') {
            return true;
          }
          // Excluir el campo "apellidoMaterno" de la validación si está vacío
          if (input.id === 'apellidoMaterno' && input.value.trim() === '') {
            input.classList.remove('is-valid', 'is-invalid');
            return true; // Se considera válido si está vacío
          }
          // Validación de correo electrónico
          if (input.id === 'correo' || input.id === 'correoRes') {
            input.addEventListener('input', function(event) {
              if (emailRegex.test(input.value.trim())) {
                input.classList.add('is-valid');
                input.classList.remove('is-invalid');
              } else {
                input.classList.add('is-invalid');
                input.classList.remove('is-valid');
              }
            });
          }
          // Validación para telefonoRes y telefonoResponsable
          if (input.id === 'telefonoRes' || input.id === 'telefonoResponsable') {
            input.addEventListener('input', function(event) {
              // Permitir solo números y limitar a 10 caracteres
              this.value = this.value.replace(/[^\d]/g, '').slice(0, 10);
              if (telefonoRegex.test(input.value.trim())) {
                input.classList.add('is-valid');
                input.classList.remove('is-invalid');
              } else {
                input.classList.add('is-invalid');
                input.classList.remove('is-valid');
              }
            });
          }
          // Validación para extension
          if (input.id === 'extension') {
            input.addEventListener('input', function(event) {
              // Permitir solo números y limitar a 4 caracteres
              this.value = this.value.replace(/[^\d]/g, '').slice(0, 4);
              if (extensionRegex.test(input.value.trim())) {
                input.classList.add('is-valid');
                input.classList.remove('is-invalid');
              } else {
                input.classList.add('is-invalid');
                input.classList.remove('is-valid');
              }
            });
          }
          // Validación para montos
          if (input.id === 'montoInversion' || input.id === 'montoInversionCompartida' || input.id === 'montoProduccion') {
            input.addEventListener('input', function(event) {
              // Permitir solo números y un punto (para decimales)
              this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');
              if (montoRegex.test(input.value.trim())) {
                input.classList.add('is-valid');
                input.classList.remove('is-invalid');
              } else {
                input.classList.add('is-invalid');
                input.classList.remove('is-valid');
              }
            });
          }
          // Validación para RFC
          if (input.id === 'rfc') {
            input.addEventListener('input', function(event) {
              // Permitir solo letras mayúsculas, números y "&"
              this.value = this.value.replace(/[^A-Z0-9&Ñ]/g, '');
              if (rfcRegex.test(input.value.trim())) {
                input.classList.add('is-valid');
                input.classList.remove('is-invalid');
              } else {
                input.classList.add('is-invalid');
                input.classList.remove('is-valid');
              }
            });
          }
          // Validación para CURP
          if (input.id === 'curpRes') {
            input.addEventListener('input', function(event) {
              // Permitir solo letras mayúsculas y números
              this.value = this.value.replace(/[^A-Z0-9]/g, '');
              if (curpRegex.test(input.value.trim())) {
                input.classList.add('is-valid');
                input.classList.remove('is-invalid');
              } else {
                input.classList.add('is-invalid');
                input.classList.remove('is-valid');
              }
            });
          }
          // Validación general para campos vacíos
          if (input.value.trim() === '') {
            input.classList.remove('is-valid');
            input.classList.add('is-invalid');
            return false;
          } else {
            input.classList.add('is-valid');
            input.classList.remove('is-invalid');
            return true;
          }
        }
        // Validar todos los inputs del paso actual del wizard
        function validateInputs(inputs) {
          return Array.from(inputs).every(input => validateInput(input)); 
        }
        // Mostrar el paso actual
        function showStep(stepNumber) {
          contents.forEach(content => {
            content.classList.add('d-none');
          });
          steps.forEach(step => {
            step.classList.remove('active');
          });
          document.getElementById(`step-${stepNumber}`).classList.remove('d-none');
          document.querySelector(`.step[data-step="${stepNumber}"]`).classList.add('active');
        }
        // Función para marcar todos los campos invalidos
        function markInvalidFields(inputs) {
          inputs.forEach(input => {
            if (input.value.trim() === '') {
              input.classList.add('is-invalid');
              input.classList.remove('is-valid');
            } else if (input.id === 'correo' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value.trim())) {
              input.classList.add('is-invalid');
              input.classList.remove('is-valid');
            } else {
              input.classList.add('is-valid');
              input.classList.remove('is-invalid');
            }
          });
        }
       // Manejo del clic en los pasos
      steps.forEach((step, index) => {
    step.addEventListener('click', () => {
      if (index === currentStepIndex + 1 || index <= currentStepIndex) {
        // Permitir avanzar al siguiente paso o regresar a pasos anteriores
        const currentInputs = contents[currentStepIndex].querySelectorAll('input, select');
        if (validateInputs(currentInputs) || index <= currentStepIndex) {
          currentStepIndex = index;
          showStep(index + 1);
        } else {
          showModal('Por favor, corrige los campos antes de continuar.');
          markInvalidFields(currentInputs); // Marcar todos los campos inválidos
        }
      } else {
        showModal('Debes completar los pasos previos antes de avanzar.');
      }
    });
  });

  // Manejo del clic en los botones "Siguiente"
  nextButtons.forEach(button => {
    button.addEventListener('click', () => {
      const currentInputs = contents[currentStepIndex].querySelectorAll('input, select');
      if (validateInputs(currentInputs)) {
        currentStepIndex++;
        showStep(currentStepIndex + 1);
      } else {
        showModal('Por favor, corrige los campos antes de continuar.');
        markInvalidFields(currentInputs); // Marcar todos los campos inválidos
      }
    });
  });

  // Manejo del clic en los botones "Anterior"
  prevButtons.forEach(button => {
    button.addEventListener('click', () => {
      if (currentStepIndex > 0) {
        currentStepIndex--;
        showStep(currentStepIndex + 1);
      }
    });
  });

  // Asignar los eventos a los inputs para la validación en tiempo real
  document.querySelectorAll('input, select').forEach(input => {
    input.addEventListener('input', function() {
      validateInput(input); // Validar cada campo cuando se ingresa texto
    });
  });
});

        document.getElementById('upload-form').addEventListener('submit', function(event) {
          event.preventDefault();
          var file = document.getElementById('excel-file').files[0];

          if (!file) {
            alert("Por favor, selecciona un archivo.");
            return;
          }
      
          var reader = new FileReader();
          reader.onload = function(event) {
            var data = new Uint8Array(event.target.result);
            var workbook = XLSX.read(data, {type: 'array'});
            var sheet = workbook.Sheets[workbook.SheetNames[0]];
            var json = XLSX.utils.sheet_to_json(sheet, {header: 1});
            var table = document.getElementById('excel-table');
        
            // Limpiar la tabla antes de agregar nueva información
            table.innerHTML = '';
        
            // Crear encabezado con columna vacía para numeración
            var thead = table.createTHead();
            var row = thead.insertRow();
            var th = document.createElement('th');
            th.appendChild(document.createTextNode(''));
            row.appendChild(th);
            json[0].forEach(function(cell) {
              var th = document.createElement('th');
              th.appendChild(document.createTextNode(cell));
              row.appendChild(th);
            });
        
            // Crear cuerpo de la tabla con numeración de filas
            var tbody = table.createTBody();
            json.slice(1).forEach(function(rowData, index) {
              var row = tbody.insertRow();
              var cell = row.insertCell();
              cell.appendChild(document.createTextNode(index + 1));
              rowData.forEach(function(cellData) {
                var cell = row.insertCell();
                cell.appendChild(document.createTextNode(cellData));
              });
            });
          };
          reader.readAsArrayBuffer(file);
        });
        //Manejar subida de archivos
        document.getElementById('uploadPdfBtn').onclick = function() {
          document.getElementById('pdfFile').click();
        };
        document.getElementById('uploadXmlBtn').onclick = function() {
          document.getElementById('xmlFile').click();
        };
        document.getElementById('pdfFile').addEventListener('change', function(event) {
          let file = event.target.files[0];
          if (file) {
            uploadFile(file, 'pdf');
          }
        });
        document.getElementById('xmlFile').addEventListener('change', function(event) {
          let file = event.target.files[0];
          if (file) {
            uploadFile(file, 'xml');
          }
        });
         /* --------------------------------------------*/
window.addEventListener('load', function() {
  var scrollButton = document.getElementById('scrollButton');
  scrollButton.style.display = 'block';
  scrollButton.classList.add('bounce');
});

// Función para manejar el scroll
window.addEventListener('scroll', function() {
  var scrollButton = document.getElementById('scrollButton');
  var scrollPosition = window.scrollY;
  var documentHeight = document.documentElement.scrollHeight;
  var windowHeight = window.innerHeight;

  if (scrollPosition < documentHeight - windowHeight - 50) {
    scrollButton.classList.add('bounce');
    scrollButton.style.opacity = '1'; // Hacerlo visible cuando haya contenido para hacer scroll
  } else {
    scrollButton.style.opacity = '0';
    scrollButton.classList.remove('bounce');
  }
});

// Si el usuario hace clic en la flecha, ir hacia abajo
document.getElementById('scrollButton').addEventListener('click', function() {
  window.scrollTo({
    top: document.documentElement.scrollHeight,
    behavior: 'smooth'
  });
});

document.documentElement.style.setProperty('--animate-duration', '2s');

document.documentElement.style.setProperty('--animate-duration', '.5s');
        $(document).ready(function() {
  // Alternar la visibilidad de la contraseña
  $('#mostrarContrasena').change(function() {
    var tipo = $(this).prop('checked') ? 'text' : 'password';
    $('#contrasena').attr('type', tipo);
  });
  $('#mostrarPassword').change(function() {
    var tipo1 = $(this).prop('checked') ? 'text' : 'password';
    $('#password').attr('type', tipo1);
  });
});

      </script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    </body>
  </html>
